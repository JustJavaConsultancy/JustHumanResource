<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <!-- Google Fonts for Inter (added for consistent typography) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    primary: { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a' },
                    secondary: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a' }
                },
                fontFamily: { 'sans': ['Inter', 'system-ui', '-apple-system', 'sans-serif'] },
                borderRadius: { 'xl': '1rem', '2xl': '1.5rem' }
            }
        }
    };
  </script>
  <style>
    * { font-family: 'Inter', sans-serif; }
    body { overflow-x: hidden; }
    .sidebar-item { transition: all 0.2s ease; position: relative; }
    .sidebar-item.active { background-color: rgba(59, 130, 246, 0.1); color: #3b82f6; border-left: 3px solid #3b82f6; }
    .sidebar-item.active .material-icons-round { color: #3b82f6; }
    .sidebar-item:hover:not(.active) { background-color: rgba(59, 130, 246, 0.05); }
    .dark .sidebar-item.active { background-color: rgba(59, 130, 246, 0.2); }
    .badge { padding: 2px 8px; font-size: 0.75rem; font-weight: 500; border-radius: 9999px; }
    .badge-success { background-color: #dcfce7; color: #16a34a; }
    .badge-warning { background-color: #fef3c7; color: #d97706; }
    .badge-error { background-color: #fee2e2; color: #dc2626; }
    .badge-info { background-color: #dbeafe; color: #2563eb; }
    .badge-purple { background-color: #f3e8ff; color: #9333ea; }
    .badge-yellow { background-color: #fef3c7; color: #d97706; }
    .badge-gray { background-color: #f1f5f9; color: #64748b; }
    .form-input { border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 0.75rem; width: 100%; transition: border-color 0.2s; }
    .form-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
    .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
    .sidebar-container { position: fixed; top: 0; left: 0; height: 100vh; width: 16rem; z-index: 40; overflow-y: auto; }
    .main-content { margin-left: 16rem; width: calc(100% - 16rem); min-height: 100vh; }
    @media (max-width: 1023px) {
        .sidebar-container { transform: translateX(-100%); }
        .sidebar-container.open { transform: translateX(0); }
        .main-content { margin-left: 0; width: 100%; }
    }
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
    .dark .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; }
    .allowance-badge { background-color: #dcfce7; color: #16a34a; border: 1px solid #86efac; }
    .deduction-badge { background-color: #fee2e2; color: #dc2626; border: 1px solid #fca5a5; }
    .payroll-card { transition: all 0.2s ease; border: 1px solid #e5e7eb; }
    .payroll-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
    .dark .payroll-card { border-color: #374151; }
    .dark .payroll-card:hover { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3); }
    .taxable-badge { background-color: #fef3c7; color: #d97706; font-size: 0.7rem; padding: 1px 6px; border-radius: 4px; }
    .statutory-badge { background-color: #dbeafe; color: #2563eb; font-size: 0.7rem; padding: 1px 6px; border-radius: 4px; }
    .grade-badge { padding: 2px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: 500; }
    .grade-1 { background-color: #dbeafe; color: #1e40af; }
    .grade-2 { background-color: #dcfce7; color: #166534; }
    .grade-3 { background-color: #f0f9ff; color: #0c4a6e; }
    .grade-4 { background-color: #fef3c7; color: #92400e; }
    .grade-5 { background-color: #f3e8ff; color: #5b21b6; }
    .grade-6 { background-color: #fce7f3; color: #9d174d; }
    .grade-7 { background-color: #fef3c7; color: #92400e; }
    /* Back button styling */
    .back-link {
        display: inline-flex;
        align-items: center;
        color: #4b5563;
        font-size: 0.875rem;
        font-weight: 500;
        padding: 0.375rem 0.75rem;
        border-radius: 0.375rem;
        transition: all 0.15s ease;
        margin-bottom: 1rem;
    }
    .back-link:hover {
        background-color: #f3f4f6;
        color: #1f2937;
    }
    .dark .back-link {
        color: #9ca3af;
    }
    .dark .back-link:hover {
        background-color: #374151;
        color: #e5e7eb;
    }
    .back-link .material-icons-round {
        font-size: 1.25rem;
        margin-right: 0.25rem;
    }
  </style>
</head>
<body>
<main layout:fragment="content">
  <div class="mb-4 flex items-center gap-2 text-sm text-slate-500">
    <a th:href="@{/payroll}" class="hover:text-primary transition-colors flex items-center gap-1">
      <span class="material-icons-round">arrow_back</span>
      Back to Dashboard
    </a>
    <span class="mx-2">/</span>
    <span class="font-medium text-slate-900 dark:text-white">Employee Payroll</span>
  </div>
  <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 mb-6">
    <div class="p-4 md:p-6 border-b border-gray-200 dark:border-gray-700">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
          <h3 class="text-lg font-bold">Employee Payroll</h3>
          <p class="text-sm text-gray-500">View and edit employee payroll information</p>
        </div>
        <div class="flex flex-wrap gap-3">
          <select id="employeeFilter" class="form-input py-2 w-full md:w-40" onchange="filterEmployeePayroll()">
            <option value="">All Employees</option>
            <option value="engineering">Engineering</option>
            <option value="sales">Sales</option>
            <option value="marketing">Marketing</option>
          </select>
          <select id="paygroupFilter" class="form-input py-2 w-full md:w-40" onchange="filterEmployeePayroll()">
            <option value="">All Paygroups</option>
            <option value="executive">Executive Level</option>
            <option value="mid">Mid Level</option>
            <option value="junior">Junior Level</option>
          </select>
          <select id="gradeFilter" class="form-input py-2 w-full md:w-40" onchange="filterEmployeePayroll()">
            <option value="">All Grades</option>
            <option value="1">Grade 1</option>
            <option value="2">Grade 2</option>
            <option value="3">Grade 3</option>
            <option value="4">Grade 4</option>
            <option value="5">Grade 5</option>
            <option value="6">Grade 6</option>
            <option value="7">Grade 7</option>
          </select>
        </div>
      </div>
    </div>

    <div class="overflow-x-auto custom-scrollbar">
      <table class="w-full">
        <thead class="bg-gray-50 dark:bg-gray-750">
        <tr>
          <th class="px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Employee</th>
          <th class="px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Pay Day</th>
          <th class="px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Basic Salary</th>
          <th class="px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Deductions</th>
          <th class="px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Net Salary</th>
          <th class="px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
        <!-- Data rows -->
        <tr th:each="payroll : ${paySlips}" class="bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
          <td th:text="${payroll.employeeName}" class="px-4 md:px-6 py-4 whitespace-nowrap flex items-center gap-3">
            Akinrinde Akinkunmi
          </td>
          <td th:text="${payroll.payDate}" class="px-4 md:px-6 py-4 whitespace-nowrap">
            2024-06-30
          </td>
          <td th:text="${'₦' + payroll.grossPay}" class="px-4 md:px-6 py-4 whitespace-nowrap">
            ₦5,000
          </td>
          <td th:text="${payroll.totalDeductions}" class="px-4 md:px-6 py-4 whitespace-nowrap">
            5
          </td>
          <td th:text="${'₦' + payroll.netPay}" class="px-4 md:px-6 py-4 whitespace-nowrap">
            ₦4,750
          </td>
          <td class="px-4 md:px-6 py-4 whitespace-nowrap">
            <!-- Updated download link to call JavaScript function -->
            <a href="javascript:void(0);"
               onclick="downloadPayslip(this)"
               class="inline-flex items-center gap-1.5 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors duration-200">
              <i class="bi bi-download text-xs"></i>
              <span>Download payslip</span>
            </a>
          </td>
        </tr>

        <!-- Empty state row (shown when no payslips exist) -->
        <tr th:if="${#lists.isEmpty(paySlips)}">
          <td colspan="6" class="px-4 md:px-6 py-12 text-center">
            <div class="flex flex-col items-center justify-center">
              <i class="bi bi-inbox text-5xl text-gray-300 dark:text-gray-600 mb-4"></i>
              <p class="text-base font-medium text-gray-500 dark:text-gray-400">No payslips found</p>
              <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">There are no payslips to display for the selected period.</p>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Hidden Payslip Template (will be used for PDF generation) -->
  <div id="payslip-template" style="display: none;">
    <div id="payslip-content" class="bg-white p-8 max-w-3xl mx-auto border border-gray-200 rounded-xl shadow-lg" style="font-family: 'Inter', sans-serif;">
      <!-- Header -->
      <div class="flex justify-between items-center border-b border-gray-200 pb-4 mb-6">
        <div>
          <h1 class="text-2xl font-bold text-primary-600">PAYSLIP</h1>
          <p class="text-sm text-gray-500">Generated on <span id="payslip-generated-date">2025-03-15</span></p>
        </div>
        <div class="text-right">
          <p class="font-semibold text-gray-800">Your Company Name</p>
          <p class="text-sm text-gray-500">123 Business St., City</p>
        </div>
      </div>

      <!-- Employee & Period Details -->
      <div class="grid grid-cols-2 gap-6 mb-6">
        <div>
          <p class="text-xs text-gray-500 uppercase tracking-wide">Employee</p>
          <p class="font-medium text-gray-800" id="payslip-employee-name">John Doe</p>
        </div>
        <div>
          <p class="text-xs text-gray-500 uppercase tracking-wide">Pay Period</p>
          <p class="font-medium text-gray-800" id="payslip-pay-date">2024-06-30</p>
        </div>
      </div>

      <!-- Earnings Table (only Basic Salary, no deductions) -->
      <table class="w-full mb-6">
        <thead class="bg-gray-50 border-y border-gray-200">
        <tr>
          <th class="py-2 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
          <th class="py-2 text-right text-xs font-medium text-gray-500 uppercase">Amount</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td class="py-3 text-gray-700">Basic Salary</td>
          <td class="py-3 text-right font-medium text-gray-900" id="payslip-basic-salary">₦5,000</td>
        </tr>
        <!-- No deduction rows -->
        </tbody>
      </table>

      <!-- Net Pay -->
      <div class="flex justify-end border-t border-gray-200 pt-4">
        <div class="w-64">
          <div class="flex justify-between items-center">
            <span class="text-base font-semibold text-gray-700">Net Pay</span>
            <span class="text-xl font-bold text-primary-600" id="payslip-net-pay">₦4,750</span>
          </div>
          <p class="text-xs text-gray-500 text-right mt-1">After all deductions</p>
        </div>
      </div>

      <!-- Footer Note -->
      <div class="mt-8 text-xs text-center text-gray-400 border-t border-gray-100 pt-4">
        This is a computer‑generated payslip. No signature required.
      </div>
    </div>
  </div>

  <!-- html2pdf library (added for PDF generation) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Download function -->
  <script>
    function downloadPayslip(button) {
      // Find the parent row
      const row = button.closest('tr');
      if (!row) return;

      // Extract cell data (indices: 0=Employee, 1=Pay Day, 2=Basic Salary, 4=Net Salary)
      const cells = row.cells;
      const employeeName = cells[0]?.textContent.trim() || 'N/A';
      const payDate = cells[1]?.textContent.trim() || 'N/A';
      const basicSalary = cells[2]?.textContent.trim() || '₦0';
      const netPay = cells[4]?.textContent.trim() || '₦0';

      // Populate template fields
      document.getElementById('payslip-employee-name').textContent = employeeName;
      document.getElementById('payslip-pay-date').textContent = payDate;
      document.getElementById('payslip-basic-salary').textContent = basicSalary;
      document.getElementById('payslip-net-pay').textContent = netPay;
      document.getElementById('payslip-generated-date').textContent = new Date().toISOString().split('T')[0];

      // Get the template element
      const element = document.getElementById('payslip-content');

      // Configure PDF options
      const opt = {
        margin:        [0.5, 0.5, 0.5, 0.5], // top, right, bottom, left (inches)
        filename:     `payslip-${employeeName.replace(/\s+/g, '_')}.pdf`,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2, letterRendering: true },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };

      // Generate and download PDF
      html2pdf().set(opt).from(element).save();
    }

    // Optional: define filter functions (if not defined elsewhere)
    function filterEmployeePayroll() {
      // Placeholder – implement your filtering logic
      console.log('Filter changed');
    }
  </script>
</main>

</body>
</html>