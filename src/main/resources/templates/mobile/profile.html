<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.w3.org/1999/xhtml"
      layout:decorate="layouts/mobileEmployeeLayout">
<head>
    <meta charset="UTF-8">
    <title>Profile · My Info</title>
    <!-- Tailwind + fonts -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL@20..48,100..700,0..1&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
          darkMode: "class",
          theme: {
            extend: {
              colors: {
                primary: "#2463eb",
                "background-light": "#f6f6f8",
                "background-dark": "#111621",
              },
              fontFamily: { display: ["Inter"], mono: ["DM Mono", "monospace"] },
              borderRadius: { DEFAULT: "1rem", lg: "1.5rem", xl: "2rem", full: "9999px" },
              boxShadow: {
                'soft': '0 4px 20px -4px rgba(0, 0, 0, 0.08), 0 2px 6px -2px rgba(0, 0, 0, 0.02)',
                'card': '0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.02)',
              }
            }
          }
        }
    </script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background-color: #f6f6f8; }
        .dark body { background-color: #111621; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .badge { padding:0.2rem 0.7rem; font-size:0.65rem; font-weight:600; border-radius:9999px; letter-spacing:0.02em; text-transform:uppercase; display:inline-flex; align-items:center; gap:0.2rem; }
        .badge-success { background:#dcfce7; color:#15803d; }
        .badge-warning { background:#fef3c7; color:#b45309; }
        .badge-info    { background:#dbeafe; color:#1e40af; }
        .badge-grade   { background:#dbeafe; color:#1e40af; }
        .dark .badge-success { background:#14532d; color:#86efac; }
        .dark .badge-warning { background:#92400e; color:#fde68a; }
        .dark .badge-grade   { background:#1e3a8a; color:#bfdbfe; }

        .field-pill {
          display: inline-flex; align-items: center; gap: 4px;
          padding: 2px 8px; border-radius: 9999px; font-size: 0.6rem;
          font-weight: 600; letter-spacing: 0.04em; text-transform: uppercase;
        }
        .pill-system { background: #e0e7ff; color: #1e40af; border: 1px solid #bfdbfe; }
        .pill-employee { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .dark .pill-system { background: #1e3a8a; color: #bfdbfe; border-color: #3b82f6; }
        .dark .pill-employee { background: #14532d; color: #86efac; border-color: #166534; }

        .card {
          background: white; border: 1px solid #e5e7eb; border-radius: 1.25rem;
          transition: border-color 0.2s, box-shadow 0.2s;
        }
        .dark .card { background: #1f2937; border-color: #374151; }

        .section-header {
          display: flex; align-items: center; justify-content: space-between;
          margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid #e5e7eb;
        }
        .dark .section-header { border-bottom-color: #374151; }

        .section-icon {
          width: 34px; height: 34px; border-radius: 10px;
          display: flex; align-items: center; justify-content: center;
        }
        .section-icon.blue { background: #dbeafe; color: #1d4ed8; }
        .section-icon.green { background: #dcfce7; color: #15803d; }
        .section-icon.purple { background: #ede9fe; color: #6d28d9; }
        .section-icon.amber { background: #fef3c7; color: #92400e; }
        .section-icon.rose { background: #ffe4e6; color: #be123c; }
        .dark .section-icon.blue { background: #1e3a8a; color: #93c5fd; }
        .dark .section-icon.green { background: #14532d; color: #86efac; }
        .dark .section-icon.purple { background: #2e1065; color: #c4b5fd; }
        .dark .section-icon.amber { background: #1c1207; color: #fcd34d; }
        .dark .section-icon.rose { background: #4c0519; color: #fda4af; }

        .section-title { font-size:0.75rem; font-weight:700; text-transform:uppercase; letter-spacing:0.06em; color:#64748b; }
        .dark .section-title { color:#94a3b8; }

        .info-item { display:flex; flex-direction:column; gap:4px; }
        .info-label { font-size:0.65rem; font-weight:600; text-transform:uppercase; color:#94a3b8; }
        .info-value { font-size:0.9rem; font-weight:500; color:#0f172a; }
        .dark .info-value { color:#f1f5f9; }
        .info-value.empty { color:#92400e; font-style:italic; display:flex; align-items:center; gap:4px; }
        .dark .info-value.empty { color:#fcd34d; }

        .completion-chip {
          display:inline-flex; align-items:center; gap:6px; padding:4px 12px; border-radius:9999px;
          font-size:0.7rem; font-weight:700; text-transform:uppercase;
        }
        .chip-incomplete { background:#fffbeb; color:#92400e; border:1px solid #fde68a; }
        .chip-complete { background:#dcfce7; color:#15803d; border:1px solid #bbf7d0; }
        .dark .chip-incomplete { background:#1c1207; color:#fcd34d; border-color:#92400e; }
        .dark .chip-complete { background:#052e16; color:#86efac; border-color:#166534; }

        .edit-btn {
          display:inline-flex; align-items:center; gap:4px; padding:6px 12px; border-radius:8px;
          font-size:0.7rem; font-weight:600; cursor:pointer; transition: background 0.15s, transform 0.1s;
          border:none; outline:none;
        }
        .edit-btn:active { transform:scale(0.97); }
        .edit-btn-primary { background:#2563eb; color:white; }
        .edit-btn-ghost { background:transparent; color:#2563eb; border:1.5px solid #bfdbfe; }
        .edit-btn-fill { background:#fffbeb; color:#92400e; border:1.5px dashed #fbbf24; }
        .dark .edit-btn-ghost { color:#60a5fa; border-color:#1e3a8a; }
        .dark .edit-btn-fill { background:#1c1207; color:#fcd34d; border-color:#92400e; }

        .notice {
          display:flex; align-items:flex-start; gap:8px; padding:10px 12px; border-radius:10px;
          font-size:0.75rem; line-height:1.5;
        }
        .notice-info { background:#eff6ff; border:1px solid #bfdbfe; color:#1e40af; }
        .notice-warn { background:#fffbeb; border:1px solid #fde68a; color:#92400e; }
        .dark .notice-info { background:#1e3a8a20; border-color:#1e3a8a; color:#93c5fd; }
        .dark .notice-warn { background:#1c120720; border-color:#92400e; color:#fcd34d; }

        .avatar-ring {
          border-radius:1rem; object-fit:cover; box-shadow:0 0 0 4px #e0e7ff, 0 4px 20px rgba(37,99,235,0.12);
        }
        .dark .avatar-ring { box-shadow:0 0 0 4px #1e3a8a, 0 4px 20px rgba(37,99,235,0.2); }

        .avatar-placeholder {
          border-radius:1rem; background:linear-gradient(135deg,#e0e7ff,#dbeafe);
          display:flex; align-items:center; justify-content:center; flex-direction:column; gap:4px;
          box-shadow:0 0 0 3px white,0 0 0 5px #c7d7fe,0 4px 20px rgba(37,99,235,0.10);
          border:2.5px dashed #93c5fd; cursor:pointer; transition:box-shadow 0.2s, border-color 0.2s;
        }
        .dark .avatar-placeholder { background:linear-gradient(135deg,#1e3a8a33,#1e293b); border-color:#3b82f6; box-shadow:0 0 0 3px #0f172a,0 0 0 5px #1e3a8a; }
        .avatar-initials { font-size:1.8rem; font-weight:700; color:#2563eb; line-height:1; }
        .dark .avatar-initials { color:#93c5fd; }

        .modal-overlay {
          position:fixed; inset:0; background:rgba(0,0,0,0.45); backdrop-filter:blur(4px);
          display:flex; align-items:center; justify-content:center; z-index:200; padding:1rem;
          opacity:0; visibility:hidden; transition:opacity 0.2s, visibility 0.2s;
        }
        .modal-overlay.active { opacity:1; visibility:visible; }
        .modal-container {
          width:100%; max-width:34rem; max-height:88vh; overflow-y:auto;
          background:white; border-radius:1.5rem; box-shadow:0 25px 50px -12px black;
          transform:translateY(16px) scale(0.98); transition:transform 0.22s cubic-bezier(0.34,1.4,0.64,1);
        }
        .dark .modal-container { background:#1f2937; border:1px solid #374151; }
        .modal-overlay.active .modal-container { transform:translateY(0) scale(1); }
        .modal-header { display:flex; align-items:center; justify-content:space-between; padding:1.25rem 1.5rem; border-bottom:1px solid #e5e7eb; }
        .dark .modal-header { border-bottom-color:#374151; }
        .modal-title { font-size:1rem; font-weight:700; }
        .modal-body { padding:1.5rem; }
        .modal-footer { display:flex; justify-content:flex-end; gap:10px; padding:1rem 1.5rem; border-top:1px solid #e5e7eb; background:#f8fafc; border-radius:0 0 1.5rem 1.5rem; }
        .dark .modal-footer { background:#0f172a; border-top-color:#374151; }

        .form-input { width:100%; padding:9px 12px; border:1.5px solid #e5e7eb; border-radius:9px; background:white; font-size:0.875rem; transition:border-color 0.15s; }
        .dark .form-input { background:#1f2937; border-color:#374151; color:white; }
        .form-input:focus { border-color:#2563eb; outline:none; box-shadow:0 0 0 3px rgba(37,99,235,0.12); }
        .form-input:read-only { background:#f8fafc; color:#94a3b8; cursor:not-allowed; }

        .pay-row { display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-radius:10px; background:#f8fafc; }
        .dark .pay-row { background:#0f172a; }
        .pay-amount { font-family:'DM Mono',monospace; font-size:0.9rem; font-weight:700; }
    </style>
</head>
<body>
<main class="flex-1 overflow-y-auto no-scrollbar px-5 pb-4 space-y-5" layout:fragment="content">

    <!-- ===== PROFILE HEADER CARD ===== -->
    <div class="card p-5 mt-2">
        <div class="flex flex-col sm:flex-row gap-4">
            <!-- avatar with upload -->
            <div class="relative flex-shrink-0 self-center sm:self-start" id="avatarWrapper">
                <div id="avatarPlaceholder" class="avatar-placeholder w-24 h-24 pulse-dash" title="Click to upload your profile photo">
                    <span th:text="${employee.firstName.substring(0,1) + employee.lastName.substring(0,1)}"
                          class="avatar-initials">JO</span>
                    <span class="text-[0.55rem] font-semibold uppercase text-blue-500 dark:text-blue-300">Add photo</span>
                </div>
                <img id="avatarImage" src="" alt="Profile" class="w-24 h-24 avatar-ring" style="display:none">
                <button id="editPhotoBtn"
                        class="absolute -bottom-1 -right-1 w-8 h-8 bg-white dark:bg-slate-800 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center">
                    <span class="material-symbols-outlined text-blue-600 dark:text-blue-400 text-sm">camera_alt</span>
                </button>
            </div>

            <div class="flex-1">
                <div class="flex items-start justify-between gap-2">
                    <div>
                        <h2 th:text="${employee.firstName + ' ' + employee.lastName}"
                            class="text-xl font-bold">Jane Okafor</h2>
                        <div class="flex flex-wrap items-center gap-2 mt-1">
                            <span th:text="${employee.jobStep.jobGrade.name + ' · ' + employee.jobStep.name}"
                                  class="badge badge-grade">Grade 3 · Step 2</span>
                            <span class="badge badge-success">Active</span>
                            <span class="flex items-center gap-1 text-[0.6rem] text-slate-500 dark:text-slate-400 font-mono"
                                  th:text="${employee.employeeNumber}">EMP-2021-042</span>
                        </div>
                    </div>
                    <button id="editProfileBtn" class="edit-btn edit-btn-primary self-start">
                        <span class="material-symbols-outlined text-sm">edit</span> Edit
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-3 mt-4 pt-3 border-t border-slate-200 dark:border-slate-700">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-slate-400 text-sm">business</span>
                        <div>
                            <p class="info-label">Department</p>
                            <p th:text="${employee.department.name}" class="text-sm font-medium">Marketing</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-slate-400 text-sm">calendar_today</span>
                        <div>
                            <p class="info-label">Hire date</p>
                            <p th:text="${#temporals.format(employee.createdAt, 'dd MMM yyyy')}" class="text-sm font-medium">12 Apr 2021</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 col-span-2">
                        <span class="material-symbols-outlined text-slate-400 text-sm">mail</span>
                        <div>
                            <p class="info-label">Email</p>
                            <p th:text="${employee.email}" class="text-sm font-medium">jane.o@example.com</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- field type legend -->
    <div class="flex flex-wrap items-center gap-2">
        <span class="text-[0.55rem] font-semibold text-slate-500 uppercase">Field types:</span>
        <span class="field-pill pill-system"><span class="material-symbols-outlined text-[0.5rem]">lock</span> System</span>
        <span class="field-pill pill-employee"><span class="material-symbols-outlined text-[0.5rem]">edit</span> You can edit</span>
    </div>

    <!-- ===== PERSONAL INFORMATION ===== -->
    <div class="card p-5">
        <div class="section-header">
            <div class="flex items-center gap-2">
                <div class="section-icon blue"><span class="material-symbols-outlined text-lg">person_outline</span></div>
                <p class="section-title">Personal Information</p>
            </div>
            <button id="editPersonalInfoBtn" class="edit-btn edit-btn-ghost">
                <span class="material-symbols-outlined text-sm">edit</span> Edit
            </button>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- system fields -->
            <div class="info-item">
                <p class="info-label">Full name <span class="field-pill pill-system ml-1"><span class="material-symbols-outlined text-[0.5rem]">lock</span></span></p>
                <p th:text="${employee.firstName + ' ' + employee.lastName}" class="info-value">Jane Okafor</p>
            </div>
            <div class="info-item">
                <p class="info-label">Email <span class="field-pill pill-system ml-1"><span class="material-symbols-outlined text-[0.5rem]">lock</span></span></p>
                <p th:text="${employee.email}" class="info-value">jane.o@example.com</p>
            </div>
            <div class="info-item">
                <p class="info-label">Phone <span class="field-pill pill-system ml-1"><span class="material-symbols-outlined text-[0.5rem]">lock</span></span></p>
                <p th:text="${employee.phoneNumber}" class="info-value">+234 801 234 5678</p>
            </div>
            <!-- employee-editable fields -->
            <div class="info-item">
                <p class="info-label">Date of birth <span class="field-pill pill-employee ml-1"><span class="material-symbols-outlined text-[0.5rem]">edit</span></span></p>
                <p th:if="${employee.dateOfBirth != null}"
                   th:text="${#temporals.format(employee.dateOfBirth, 'dd MMM yyyy')}" class="info-value"></p>
                <p th:unless="${employee.dateOfBirth != null}"
                   class="info-value empty"><span class="material-symbols-outlined text-sm">warning_amber</span> Not provided</p>
            </div>
            <div class="info-item">
                <p class="info-label">Gender <span class="field-pill pill-employee ml-1"><span class="material-symbols-outlined text-[0.5rem]">edit</span></span></p>
                <p th:if="${employee.gender != null}" th:text="${employee.gender}" class="info-value"></p>
                <p th:unless="${employee.gender != null}"
                   class="info-value empty"><span class="material-symbols-outlined text-sm">warning_amber</span> Not provided</p>
            </div>
            <div class="info-item">
                <p class="info-label">Marital status <span class="field-pill pill-employee ml-1"><span class="material-symbols-outlined text-[0.5rem]">edit</span></span></p>
                <p th:if="${employee.maritalStatus != null}" th:text="${employee.maritalStatus}" class="info-value"></p>
                <p th:unless="${employee.maritalStatus != null}"
                   class="info-value empty"><span class="material-symbols-outlined text-sm">warning_amber</span> Not provided</p>
            </div>
            <div class="info-item col-span-2">
                <p class="info-label">Residential address <span class="field-pill pill-employee ml-1"><span class="material-symbols-outlined text-[0.5rem]">edit</span></span></p>
                <p th:if="${employee.residentialAddress != null}" th:text="${employee.residentialAddress}" class="info-value"></p>
                <p th:unless="${employee.residentialAddress != null}"
                   class="info-value empty"><span class="material-symbols-outlined text-sm">warning_amber</span> Not provided</p>
            </div>
            <div class="info-item col-span-2">
                <p class="info-label">My mission <span class="field-pill pill-employee ml-1"><span class="material-symbols-outlined text-[0.5rem]">edit</span></span></p>
                <p th:if="${employee.mission != null}" th:text="${employee.mission}" class="info-value"></p>
                <p th:unless="${employee.mission != null}"
                   class="info-value empty"><span class="material-symbols-outlined text-sm">warning_amber</span> Not provided</p>
            </div>
        </div>
    </div>

    <!-- ===== EMPLOYMENT DETAILS ===== -->
    <div class="card p-5">
        <div class="section-header">
            <div class="flex items-center gap-2">
                <div class="section-icon purple"><span class="material-symbols-outlined text-lg">work_outline</span></div>
                <p class="section-title">Employment Details</p>
            </div>
            <span class="field-pill pill-system"><span class="material-symbols-outlined text-[0.6rem]">lock</span> HR</span>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
            <div><span class="info-label">Employee number</span>
                <p th:text="${employee.employeeNumber}" class="font-mono">EMP-2021-042</p></div>
            <div><span class="info-label">Status</span>
                <p><span class="badge badge-success text-[0.55rem]">Active</span> · Permanent</p></div>
            <div><span class="info-label">Date of hire</span>
                <p th:text="${#temporals.format(employee.createdAt, 'dd MMMM yyyy')}">12 April 2021</p></div>
            <div><span class="info-label">Probation end</span>
                <p>11 Oct 2021 <span class="text-green-600 text-[0.6rem]">(Completed)</span></p></div>
            <div><span class="info-label">Department</span>
                <p th:text="${employee.department.name}">Marketing</p></div>
            <div><span class="info-label">Grade / Step</span>
                <p th:text="${employee.jobStep.jobGrade.name + ' · ' + employee.jobStep.name}">Grade 3 · Step 2</p></div>
            <div><span class="info-label">Pay group</span><p>PG4 - Marketing</p></div>
            <div><span class="info-label">Reports to</span>
                <p>Michael Adenuga <span class="block text-[0.55rem] text-slate-500">Marketing Manager</span></p></div>
            <div class="col-span-2"><span class="info-label">Work location</span><p>Lagos HQ</p></div>
        </div>
        <div class="notice notice-info mt-3">
            <span class="material-symbols-outlined text-sm">info</span>
            <span>Employment details are managed by HR. Contact HR for changes.</span>
        </div>
    </div>

    <!-- ===== EMERGENCY CONTACT ===== -->
    <div class="card p-5">
        <div class="section-header">
            <div class="flex items-center gap-2">
                <div class="section-icon rose"><span class="material-symbols-outlined text-lg">contact_emergency</span></div>
                <p class="section-title">Emergency Contact</p>
            </div>
            <div class="flex items-center gap-2">
                <span id="emergencyStatus" class="completion-chip"
                      th:classappend="${employee.emergencyContact != null ? 'chip-complete' : 'chip-incomplete'}">
                    <span class="material-symbols-outlined text-xs"
                          th:text="${employee.emergencyContact != null ? 'check_circle' : 'warning_amber'}">warning_amber</span>
                    <span th:text="${employee.emergencyContact != null ? 'Complete' : 'Incomplete'}">Incomplete</span>
                </span>
                <button id="editEmergencyBtn" class="edit-btn"
                        th:classappend="${employee.emergencyContact != null ? 'edit-btn-ghost' : 'edit-btn-fill'}">
                    <span class="material-symbols-outlined text-sm"
                          th:text="${employee.emergencyContact != null ? 'edit' : 'add'}">add</span>
                    <span th:text="${employee.emergencyContact != null ? 'Edit' : 'Add'}">Add</span>
                </button>
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
            <div class="info-item">
                <span class="info-label">Full name</span>
                <p th:if="${employee.emergencyContact != null}"
                   th:text="${employee.emergencyContact.contactName}" class="info-value"></p>
                <p th:unless="${employee.emergencyContact != null}" class="info-value empty">Not provided</p>
            </div>
            <div class="info-item">
                <span class="info-label">Relationship</span>
                <p th:if="${employee.emergencyContact != null}"
                   th:text="${employee.emergencyContact.relationship}" class="info-value"></p>
                <p th:unless="${employee.emergencyContact != null}" class="info-value empty">Not provided</p>
            </div>
            <div class="info-item">
                <span class="info-label">Phone</span>
                <p th:if="${employee.emergencyContact != null}"
                   th:text="${employee.emergencyContact.phoneNumber}" class="info-value"></p>
                <p th:unless="${employee.emergencyContact != null}" class="info-value empty">Not provided</p>
            </div>
            <div class="info-item">
                <span class="info-label">Alternative</span>
                <p th:if="${employee.emergencyContact != null and employee.emergencyContact.alternativePhoneNumber != null}"
                   th:text="${employee.emergencyContact.alternativePhoneNumber}" class="info-value"></p>
                <p th:unless="${employee.emergencyContact != null and employee.emergencyContact.alternativePhoneNumber != null}"
                   class="info-value empty">Not provided</p>
            </div>
        </div>
        <div class="notice notice-warn mt-3" th:unless="${employee.emergencyContact != null}">
            <span class="material-symbols-outlined text-sm">warning</span>
            <span>Please add an emergency contact. Important for your safety.</span>
        </div>
        <div class="notice notice-info mt-3" th:if="${employee.emergencyContact != null}">
            <span class="material-symbols-outlined text-sm">check_circle</span>
            <span>Emergency contact saved. You can update it anytime.</span>
        </div>
    </div>

    <!-- ===== COMPENSATION ===== -->
    <div class="card p-5">
        <div class="section-header">
            <div class="flex items-center gap-2">
                <div class="section-icon green"><span class="material-symbols-outlined text-lg">payments</span></div>
                <p class="section-title">Compensation</p>
            </div>
            <span class="field-pill pill-system"><span class="material-symbols-outlined text-[0.6rem]">lock</span> HR</span>
        </div>
        <div class="space-y-2">
            <div class="pay-row">
                <span class="pay-label">Gross Pay</span>
                <span th:text="${'₦' + latestPaySlip.grossPay}" class="pay-amount text-emerald-600">₦620,000</span>
            </div>
            <div class="pay-row">
                <span class="pay-label">Net Pay</span>
                <span th:text="${'₦' + latestPaySlip.netPay}" class="pay-amount text-primary">₦540,000</span>
            </div>
        </div>
        <a href="#" class="flex items-center justify-between mt-3 text-sm font-semibold text-primary">
            View Full Payslip <span class="material-symbols-outlined text-sm">arrow_forward</span>
        </a>
    </div>

    <!-- ===== BANK DETAILS ===== -->
    <div class="card overflow-hidden">
        <div class="bg-gradient-to-r from-blue-800 to-blue-600 p-4 text-white">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-white/80">account_balance</span>
                    <div>
                        <p class="text-[0.6rem] font-semibold uppercase tracking-wider opacity-70">Bank Details</p>
                        <p class="text-[0.55rem] opacity-60">Provided by you</p>
                    </div>
                </div>
                <span class="field-pill bg-white/20 text-white border border-white/30">
                    <span class="material-symbols-outlined text-[0.5rem]">edit</span> Yours
                </span>
            </div>
        </div>
        <div class="p-5">
            <div class="flex items-center justify-between mb-3">
                <span th:if="${not #lists.isEmpty(employee.bankDetails)}" class="completion-chip chip-complete">
                    <span class="material-symbols-outlined text-xs">check_circle</span> Set up
                </span>
                <span th:unless="${not #lists.isEmpty(employee.bankDetails)}" class="completion-chip chip-incomplete">
                    <span class="material-symbols-outlined text-xs">warning_amber</span> Not set up
                </span>
                <button id="editBankBtn" class="edit-btn"
                        th:classappend="${not #lists.isEmpty(employee.bankDetails)} ? 'edit-btn-ghost' : 'edit-btn-fill'">
                    <span class="material-symbols-outlined text-sm"
                          th:text="${not #lists.isEmpty(employee.bankDetails)} ? 'edit' : 'add'">add</span>
                    <span th:text="${not #lists.isEmpty(employee.bankDetails)} ? 'Edit' : 'Add'">Add</span>
                </button>
            </div>
            <!-- Populated -->
            <div th:if="${not #lists.isEmpty(employee.bankDetails)}" class="space-y-3">
                <div class="info-item">
                    <span class="info-label">Account Name</span>
                    <p th:text="${employee.bankDetails[0].accountName}" class="info-value">John Doe</p>
                </div>
                <div class="info-item">
                    <span class="info-label">Bank Name</span>
                    <p th:text="${employee.bankDetails[0].bankName}" class="info-value">First Bank</p>
                </div>
                <div class="info-item">
                    <span class="info-label">Account Number</span>
                    <p class="info-value font-mono"
                       th:text="'**** **** ' + ${#strings.substring(employee.bankDetails[0].accountNumber, employee.bankDetails[0].accountNumber.length()-4)}">**** **** 1234</p>
                    <p class="text-[0.55rem] text-slate-400 mt-0.5">(last 4 digits shown)</p>
                </div>
            </div>
            <!-- Empty -->
            <div th:unless="${not #lists.isEmpty(employee.bankDetails)}" class="space-y-3">
                <div class="info-item"><span class="info-label">Account Name</span><p class="info-value empty">Not provided</p></div>
                <div class="info-item"><span class="info-label">Bank Name</span><p class="info-value empty">Not provided</p></div>
                <div class="info-item"><span class="info-label">Account Number</span><p class="info-value empty">Not provided</p></div>
            </div>
            <div class="notice notice-warn mt-3">
                <span class="material-symbols-outlined text-sm">warning</span>
                <span>Bank details required for salary payments.</span>
            </div>
        </div>
    </div>

    <!-- ===== DOCUMENTS ===== -->
    <div class="card p-5">
        <div class="section-header">
            <div class="flex items-center gap-2">
                <div class="section-icon amber"><span class="material-symbols-outlined text-lg">description</span></div>
                <p class="section-title">Documents</p>
            </div>
        </div>
        <div class="space-y-1">
            <a href="#" class="flex items-center gap-3 p-2.5 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800">
                <span class="material-symbols-outlined text-red-500">picture_as_pdf</span>
                <span class="text-sm flex-1">Employment Contract.pdf</span>
                <span class="material-symbols-outlined text-sm text-slate-400">download</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-2.5 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800">
                <span class="material-symbols-outlined text-blue-500">image</span>
                <span class="text-sm flex-1">ID Card.jpg</span>
                <span class="material-symbols-outlined text-sm text-slate-400">download</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-2.5 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800">
                <span class="material-symbols-outlined text-green-500">description</span>
                <span class="text-sm flex-1">Tax Certificate.pdf</span>
                <span class="material-symbols-outlined text-sm text-slate-400">download</span>
            </a>
        </div>
        <a href="#" class="flex items-center justify-between mt-3 text-sm font-semibold text-primary">
            View All <span class="material-symbols-outlined text-sm">arrow_forward</span>
        </a>
    </div>

    <!-- ===== RECENT ACTIVITY ===== -->
    <div class="card p-5">
        <div class="section-header">
            <div class="flex items-center gap-2">
                <div class="section-icon blue"><span class="material-symbols-outlined text-lg">history</span></div>
                <p class="section-title">Recent Activity</p>
            </div>
            <a href="#" class="text-sm font-semibold text-primary">View All</a>
        </div>
        <div class="space-y-2">
            <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/40 rounded-xl">
                <div class="flex items-center gap-3">
                    <div class="w-7 h-7 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                        <span class="material-symbols-outlined text-green-600 text-sm">check</span>
                    </div>
                    <div>
                        <p class="text-xs font-semibold">Leave approved</p>
                        <p class="text-[0.55rem] text-slate-500">5 days (21–25 Mar 2025)</p>
                    </div>
                </div>
                <span class="text-[0.55rem] text-slate-400">2d ago</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/40 rounded-xl">
                <div class="flex items-center gap-3">
                    <div class="w-7 h-7 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                        <span class="material-symbols-outlined text-blue-600 text-sm">trending_up</span>
                    </div>
                    <div>
                        <p class="text-xs font-semibold">Promotion approved</p>
                        <p class="text-[0.55rem] text-slate-500">Grade 2 → 3</p>
                    </div>
                </div>
                <span class="text-[0.55rem] text-slate-400">01 Jun 2024</span>
            </div>
        </div>
    </div>
    <div class="text-center text-[0.55rem] text-slate-400 py-2">Profile information · last updated 02 Mar 2026</div>


    <!-- ========== MODALS ========== -->

    <!-- Edit Photo Modal -->
    <div id="editPhotoModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Update Profile Photo</p>
                    <p class="text-[0.65rem] text-slate-500">JPG, PNG · max 5MB</p>
                </div>
                <button class="close-modal text-slate-400"><span class="material-symbols-outlined">close</span></button>
            </div>
            <div class="modal-body space-y-4">
                <div class="flex justify-center">
                    <div id="modalAvatarPlaceholder" class="avatar-placeholder w-28 h-28">
                        <span class="avatar-initials" id="modalAvatarInitials">JO</span>
                        <span class="text-[0.5rem]">No photo</span>
                    </div>
                    <img id="modalAvatarImage" src="" class="w-28 h-28 avatar-ring" style="display:none">
                </div>
                <label class="flex items-center justify-center gap-2 w-full py-3 bg-primary text-white rounded-xl text-sm font-semibold">
                    <span class="material-symbols-outlined">upload</span> Choose Photo
                    <input type="file" accept="image/*" class="hidden" id="photoInput">
                </label>
            </div>
            <div class="modal-footer">
                <button class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                <button id="savePhotoBtn" class="edit-btn edit-btn-primary">Save Photo</button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Header Modal -->
    <div id="editProfileModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Edit Profile</p>
                    <p class="text-[0.65rem] text-slate-500">Basic information</p>
                </div>
                <button class="close-modal text-slate-400"><span class="material-symbols-outlined">close</span></button>
            </div>
            <div class="modal-body space-y-3">
                <div class="notice notice-info text-xs">Name and employee number are managed by HR.</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label class="info-label">First Name <span class="field-pill pill-system">lock</span></label>
                        <input type="text" th:value="${employee.firstName}" value="Jane" class="form-input" readonly>
                    </div>
                    <div class="form-group">
                        <label class="info-label">Last Name <span class="field-pill pill-system">lock</span></label>
                        <input type="text" th:value="${employee.lastName}" value="Okafor" class="form-input" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label class="info-label">Job Title</label>
                    <input type="text" value="Marketing Specialist" class="form-input">
                </div>
                <div class="form-group">
                    <label class="info-label">Department <span class="field-pill pill-system">lock</span></label>
                    <input type="text" th:value="${employee.department.name}" value="Marketing" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="info-label">Employee Number <span class="field-pill pill-system">lock</span></label>
                    <input type="text" th:value="${employee.employeeNumber}" value="EMP-2021-042" class="form-input font-mono" readonly>
                </div>
            </div>
            <div class="modal-footer">
                <button class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                <button class="edit-btn edit-btn-primary">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Edit Personal Info Modal -->
    <div id="editPersonalInfoModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Personal Information</p>
                    <p class="text-[0.65rem] text-slate-500">Update your details</p>
                </div>
                <button class="close-modal text-slate-400"><span class="material-symbols-outlined">close</span></button>
            </div>
            <form th:action="@{/update-personal-info}" method="post" th:object="${employee}">
                <div class="modal-body space-y-4">
                    <div class="notice notice-info text-xs">Name, email, phone are HR-managed.</div>

                    <input type="hidden" th:field="*{id}" />

                    <div class="grid grid-cols-2 gap-3">
                        <div class="form-group">
                            <label class="info-label">Full Name <span class="field-pill pill-system">lock</span></label>
                            <input type="text" th:value="*{firstName} + ' ' + *{lastName}" class="form-input" readonly>
                        </div>
                        <div class="form-group">
                            <label class="info-label">Email <span class="field-pill pill-system">lock</span></label>
                            <input type="email" th:value="*{email}" class="form-input" readonly>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="info-label">Phone <span class="field-pill pill-system">lock</span></label>
                        <input type="tel" th:value="*{phoneNumber}" class="form-input" readonly>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div class="form-group">
                            <label class="info-label">Date of birth <span class="field-pill pill-employee">edit</span></label>
                            <input type="date" th:field="*{dateOfBirth}" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="info-label">Gender <span class="field-pill pill-employee">edit</span></label>
                            <select th:field="*{gender}" class="form-input">
                                <option value="">Select gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Prefer not to say">Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="info-label">Marital status <span class="field-pill pill-employee">edit</span></label>
                        <select th:field="*{maritalStatus}" class="form-input">
                            <option value="">Select status</option>
                            <option value="Single">Single</option>
                            <option value="Married">Married</option>
                            <option value="Divorced">Divorced</option>
                            <option value="Widowed">Widowed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="info-label">Residential address <span class="field-pill pill-employee">edit</span></label>
                        <textarea th:field="*{residentialAddress}" class="form-input" rows="2" placeholder="Enter your residential address..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="info-label">My mission <span class="field-pill pill-employee">edit</span></label>
                        <textarea th:field="*{mission}" class="form-input" rows="2" placeholder="What is your personal mission?"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                    <button type="submit" class="edit-btn edit-btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Emergency Contact Modal -->
    <div id="editEmergencyModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Emergency Contact</p>
                    <p class="text-[0.65rem] text-slate-500">All fields are yours</p>
                </div>
                <button type="button" class="close-modal text-slate-400"><span class="material-symbols-outlined">close</span></button>
            </div>
            <form th:action="@{/add-emergency-contact}" method="post">
                <div class="modal-body space-y-3">
                    <div class="notice notice-warn text-xs">
                        <span class="material-symbols-outlined text-sm">emergency</span>
                        This person will be contacted in case of emergency.
                    </div>

                    <input type="hidden" name="id" th:value="${employee.id}" />

                    <div class="grid grid-cols-2 gap-3">
                        <div class="form-group">
                            <label class="info-label">Full name *</label>
                            <input type="text"
                                   name="emergencyContactName"
                                   th:value="${employee.emergencyContact?.contactName}"
                                   class="form-input"
                                   placeholder="e.g. Chidi Okafor"
                                   required>
                        </div>
                        <div class="form-group">
                            <label class="info-label">Relationship *</label>
                            <select name="emergencyRelationship" class="form-input" required>
                                <option value="">Select relationship</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Spouse'}" value="Spouse">Spouse</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Parent'}" value="Parent">Parent</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Sibling'}" value="Sibling">Sibling</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Child'}" value="Child">Child</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Friend'}" value="Friend">Friend</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Other'}" value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="info-label">Phone number *</label>
                        <input type="tel"
                               name="emergencyPhoneNumber"
                               th:value="${employee.emergencyContact?.phoneNumber}"
                               class="form-input"
                               placeholder="+234 8XX XXX XXXX"
                               required>
                    </div>
                    <div class="form-group">
                        <label class="info-label">Alternative phone</label>
                        <input type="tel"
                               name="emergencyAlternativePhoneNumber"
                               th:value="${employee.emergencyContact?.alternativePhoneNumber}"
                               class="form-input"
                               placeholder="+234 8XX XXX XXXX (optional)">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                    <button type="submit" class="edit-btn edit-btn-primary">Save Contact</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Bank Modal -->
    <div id="editBankModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Bank Details</p>
                    <p class="text-[0.65rem] text-slate-500">Managed by you</p>
                </div>
                <button class="close-modal text-slate-400"><span class="material-symbols-outlined">close</span></button>
            </div>
            <form th:action="@{/update/bank-info}" method="post">
                <div class="modal-body space-y-3">
                    <div class="notice notice-warn text-xs">
                        <span class="material-symbols-outlined text-sm">account_balance</span>
                        Salary will be paid to this account. Ensure all details are accurate.
                    </div>

                    <input type="hidden" name="id" th:value="${employee.id}" />

                    <div class="form-group">
                        <label class="info-label">Account Name *</label>
                        <input type="text"
                               name="accountName"
                               th:value="${not #lists.isEmpty(employee.bankDetails) ? employee.bankDetails[0].accountName : ''}"
                               class="form-input"
                               placeholder="Full name as on bank account"
                               required>
                    </div>
                    <div class="form-group">
                        <label class="info-label">Bank Name *</label>
                        <input type="text"
                               name="bankName"
                               th:value="${not #lists.isEmpty(employee.bankDetails) ? employee.bankDetails[0].bankName : ''}"
                               class="form-input"
                               placeholder="e.g. First Bank"
                               required>
                    </div>
                    <div class="form-group">
                        <label class="info-label">Account Number *</label>
                        <input type="text"
                               name="accountNumber"
                               th:value="${not #lists.isEmpty(employee.bankDetails) ? employee.bankDetails[0].accountNumber : ''}"
                               class="form-input font-mono"
                               placeholder="10-digit NUBAN"
                               maxlength="10"
                               required>
                    </div>
                    <div class="notice notice-info text-xs mt-2">
                        <span class="material-symbols-outlined text-sm">security</span>
                        Encrypted; only last 4 digits shown.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                    <button type="submit" class="edit-btn edit-btn-primary">Save Bank Details</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        (function() {
          const modals = {
            editPhoto: document.getElementById('editPhotoModal'),
            editProfile: document.getElementById('editProfileModal'),
            editPersonalInfo: document.getElementById('editPersonalInfoModal'),
            editEmergency: document.getElementById('editEmergencyModal'),
            editBank: document.getElementById('editBankModal'),
          };

          function openModal(modal) { modal.classList.add('active'); document.body.style.overflow = 'hidden'; }
          function closeModal(modal) { modal.classList.remove('active'); document.body.style.overflow = ''; }

          document.getElementById('editPhotoBtn').addEventListener('click', () => openModal(modals.editPhoto));
          document.getElementById('editProfileBtn').addEventListener('click', () => openModal(modals.editProfile));
          document.getElementById('editPersonalInfoBtn').addEventListener('click', () => openModal(modals.editPersonalInfo));
          document.getElementById('editEmergencyBtn').addEventListener('click', () => openModal(modals.editEmergency));
          document.getElementById('editBankBtn').addEventListener('click', () => openModal(modals.editBank));

          // Avatar placeholder also opens photo modal
          const avatarPlaceholder = document.getElementById('avatarPlaceholder');
          if (avatarPlaceholder) avatarPlaceholder.addEventListener('click', () => openModal(modals.editPhoto));

          document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', e => { const modal = e.target.closest('.modal-overlay'); if(modal) closeModal(modal); });
          });

          Object.values(modals).forEach(m => {
            if(m) m.addEventListener('click', e => { if(e.target === m) closeModal(m); });
          });

          document.addEventListener('keydown', e => { if(e.key === 'Escape') Object.values(modals).forEach(m => closeModal(m)); });

          // Avatar initials from rendered name
          const nameEl = document.querySelector('h2');
          const name = nameEl ? nameEl.textContent.trim() : 'JO';
          const parts = name.trim().split(/\s+/);
          const initials = parts.length >= 2
            ? (parts[0][0] + parts[parts.length-1][0]).toUpperCase()
            : (parts[0] ? parts[0][0].toUpperCase() : '?');
          document.querySelectorAll('.avatar-initials').forEach(el => el.textContent = initials);

          // Photo upload preview
          const photoInput = document.getElementById('photoInput');
          const modalPlaceholder = document.getElementById('modalAvatarPlaceholder');
          const modalImage = document.getElementById('modalAvatarImage');
          const avatarImage = document.getElementById('avatarImage');

          if(photoInput) {
            photoInput.addEventListener('change', function() {
              const file = this.files[0];
              if(!file) return;
              const reader = new FileReader();
              reader.onload = e => {
                if(modalImage) { modalImage.src = e.target.result; modalImage.style.display = ''; }
                if(modalPlaceholder) modalPlaceholder.style.display = 'none';
                photoInput._src = e.target.result;
              };
              reader.readAsDataURL(file);
            });
          }

          document.getElementById('savePhotoBtn')?.addEventListener('click', () => {
            const src = photoInput?._src;
            if(!src) { alert('Please choose a photo first.'); return; }
            if(avatarImage) { avatarImage.src = src; avatarImage.style.display = ''; }
            if(avatarPlaceholder) avatarPlaceholder.style.display = 'none';
            closeModal(modals.editPhoto);
            if(modalImage) { modalImage.src = ''; modalImage.style.display = 'none'; }
            if(modalPlaceholder) modalPlaceholder.style.display = '';
            photoInput.value = '';
            delete photoInput._src;
          });

          // Disable submit on form submission to prevent double-clicks
          document.querySelectorAll('form[th\\:action]').forEach(form => {
            form.addEventListener('submit', function() {
              const btn = this.querySelector('button[type="submit"]');
              if(btn) { btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed'); }
            });
          });
        })();
    </script>
</main>
</body>
</html>