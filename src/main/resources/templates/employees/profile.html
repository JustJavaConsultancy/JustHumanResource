<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.w3.org/1999/xhtml"
      layout:decorate="layouts/employeeLayout">
<head>
    <meta charset="UTF-8">
    <title>Employee Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd',
                            400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8',
                            800: '#1e40af', 900: '#1e3a8a',
                        },
                    },
                }
            }
        };
    </script>
    <style>
        *, *::before, *::after { box-sizing: border-box; }

        :root {
            --sys-bg: #f0f4ff;
            --sys-border: #c7d7fe;
            --sys-text: #3730a3;
            --sys-icon: #4f46e5;
            --emp-bg: #f0fdf4;
            --emp-border: #bbf7d0;
            --emp-text: #166534;
            --emp-icon: #16a34a;
            --empty-bg: #fffbeb;
            --empty-border: #fde68a;
            --empty-text: #92400e;
            --card-bg: #ffffff;
            --card-border: #e5e7eb;
            --page-bg: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
        }

        .dark {
            --sys-bg: #1e1b4b;
            --sys-border: #3730a3;
            --sys-text: #a5b4fc;
            --emp-bg: #052e16;
            --emp-border: #166534;
            --emp-text: #86efac;
            --empty-bg: #1c1207;
            --empty-border: #92400e;
            --empty-text: #fcd34d;
            --card-bg: #1e293b;
            --card-border: #334155;
            --page-bg: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background-color: var(--page-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* ── CARDS ─────────────────────────────────────── */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 1.25rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        /* ── FIELD TYPE PILLS ──────────────────────────── */
        .field-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.65rem;
            font-weight: 600;
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        .pill-system {
            background: var(--sys-bg);
            color: var(--sys-text);
            border: 1px solid var(--sys-border);
        }

        .pill-employee {
            background: var(--emp-bg);
            color: var(--emp-text);
            border: 1px solid var(--emp-border);
        }

        /* ── INFO GRID ITEMS ──────────────────────────── */
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted);
        }

        .info-value {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Empty / not-yet-filled state */
        .info-value.empty {
            color: var(--empty-text);
            font-style: italic;
            font-size: 0.85rem;
        }

        .info-value-wrapper {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* System-locked field styling */
        .system-field .info-value {
            color: var(--sys-text);
            font-weight: 500;
        }

        /* ── SECTION HEADERS ──────────────────────────── */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--card-border);
        }

        .section-title-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-icon {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .section-icon.blue { background: #dbeafe; color: #1d4ed8; }
        .section-icon.green { background: #dcfce7; color: #15803d; }
        .section-icon.purple { background: #ede9fe; color: #6d28d9; }
        .section-icon.amber { background: #fef3c7; color: #92400e; }
        .section-icon.rose { background: #ffe4e6; color: #be123c; }

        .dark .section-icon.blue { background: #1e3a8a; color: #93c5fd; }
        .dark .section-icon.green { background: #14532d; color: #86efac; }
        .dark .section-icon.purple { background: #2e1065; color: #c4b5fd; }
        .dark .section-icon.amber { background: #1c1207; color: #fcd34d; }
        .dark .section-icon.rose { background: #4c0519; color: #fda4af; }

        .section-title {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-secondary);
        }

        /* ── EDIT BUTTONS ─────────────────────────────── */
        .edit-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.78rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.15s, transform 0.1s;
            border: none;
            outline: none;
        }

        .edit-btn:active { transform: scale(0.97); }

        .edit-btn-primary {
            background: #2563eb;
            color: white;
        }
        .edit-btn-primary:hover { background: #1d4ed8; }

        .edit-btn-ghost {
            background: transparent;
            color: #2563eb;
            border: 1.5px solid #bfdbfe;
        }
        .edit-btn-ghost:hover { background: #eff6ff; }

        .dark .edit-btn-ghost {
            color: #60a5fa;
            border-color: #1e3a8a;
        }
        .dark .edit-btn-ghost:hover { background: #1e3a8a; }

        /* Edit button for unfilled sections - more prominent */
        .edit-btn-fill {
            background: #fffbeb;
            color: #92400e;
            border: 1.5px dashed #fbbf24;
        }
        .edit-btn-fill:hover { background: #fef3c7; }

        .dark .edit-btn-fill {
            background: #1c1207;
            color: #fcd34d;
            border-color: #92400e;
        }

        /* ── COMPLETION BANNER ────────────────────────── */
        .completion-bar-wrap {
            height: 6px;
            background: #e2e8f0;
            border-radius: 99px;
            overflow: hidden;
        }

        .dark .completion-bar-wrap { background: #334155; }

        .completion-bar-fill {
            height: 100%;
            border-radius: 99px;
            background: linear-gradient(90deg, #2563eb, #10b981);
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* ── BADGE ────────────────────────────────────── */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 9999px;
            font-size: 0.68rem;
            font-weight: 700;
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }
        .badge-active { background: #dcfce7; color: #15803d; }
        .badge-grade { background: #dbeafe; color: #1e40af; }
        .dark .badge-active { background: #14532d; color: #86efac; }
        .dark .badge-grade { background: #1e3a8a; color: #bfdbfe; }

        /* ── PROFILE AVATAR ───────────────────────────── */
        .avatar-ring {
            border-radius: 1rem;
            object-fit: cover;
            box-shadow: 0 0 0 4px #e0e7ff, 0 4px 20px rgba(37,99,235,0.12);
        }

        .dark .avatar-ring {
            box-shadow: 0 0 0 4px #1e3a8a, 0 4px 20px rgba(37,99,235,0.2);
        }

        /* ── AVATAR PLACEHOLDER ──────────────────────── */
        .avatar-placeholder {
            border-radius: 1rem;
            background: linear-gradient(135deg, #e0e7ff 0%, #dbeafe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 4px;
            position: relative;
            box-shadow: 0 0 0 3px #fff, 0 0 0 5px #c7d7fe, 0 4px 20px rgba(37,99,235,0.10);
            border: 2.5px dashed #93c5fd;
            cursor: pointer;
            transition: box-shadow 0.2s, border-color 0.2s, background 0.2s;
        }

        .dark .avatar-placeholder {
            background: linear-gradient(135deg, #1e3a8a33 0%, #1e293b 100%);
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px #0f172a, 0 0 0 5px #1e3a8a, 0 4px 20px rgba(37,99,235,0.2);
        }

        .avatar-placeholder:hover {
            border-color: #2563eb;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            box-shadow: 0 0 0 3px #fff, 0 0 0 5px #2563eb, 0 8px 24px rgba(37,99,235,0.18);
        }

        .dark .avatar-placeholder:hover {
            background: linear-gradient(135deg, #1e3a8a55 0%, #1e293b 100%);
        }

        .avatar-initials {
            font-family: 'DM Sans', sans-serif;
            font-weight: 700;
            color: #2563eb;
            line-height: 1;
            user-select: none;
        }

        .dark .avatar-initials { color: #93c5fd; }

        .avatar-upload-hint {
            font-size: 0.58rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #60a5fa;
            opacity: 0.9;
        }

        .dark .avatar-upload-hint { color: #93c5fd; }

        @keyframes dashPulse {
            0%, 100% { border-color: #93c5fd; }
            50% { border-color: #2563eb; }
        }

        .avatar-placeholder.pulse-dash {
            animation: dashPulse 2.5s ease-in-out infinite;
        }

        /* Modal placeholder (larger) */
        .avatar-placeholder-lg {
            width: 7rem;
            height: 7rem;
            border-radius: 1.1rem;
        }

        .avatar-placeholder-lg .avatar-initials {
            font-size: 2rem;
        }

        /* ── MODALS ───────────────────────────────────── */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            width: 100%;
            max-width: 34rem;
            max-height: 88vh;
            overflow-y: auto;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 1.25rem;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            transform: translateY(16px) scale(0.98);
            transition: transform 0.22s cubic-bezier(0.34, 1.4, 0.64, 1);
        }

        .modal-overlay.active .modal-container {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--card-border);
        }

        .modal-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-subtitle {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .modal-body { padding: 1.5rem; }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--card-border);
            background: var(--page-bg);
            border-radius: 0 0 1.25rem 1.25rem;
        }

        /* ── FORM FIELDS ──────────────────────────────── */
        .form-group { display: flex; flex-direction: column; gap: 5px; }

        .form-label {
            font-size: 0.72rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 9px 12px;
            border: 1.5px solid var(--card-border);
            border-radius: 9px;
            background: var(--card-bg);
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.875rem;
            transition: border-color 0.15s, box-shadow 0.15s;
            outline: none;
        }

        .form-input:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37,99,235,0.12);
        }

        .form-input:read-only {
            background: var(--page-bg);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        textarea.form-input { resize: vertical; min-height: 80px; }

        /* ── NOTICE BOXES ─────────────────────────────── */
        .notice {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 10px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            line-height: 1.5;
        }

        .notice-info {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            color: #1e40af;
        }

        .notice-warn {
            background: #fffbeb;
            border: 1px solid #fde68a;
            color: #92400e;
        }

        .dark .notice-info { background: #1e3a8a20; border-color: #1e3a8a; color: #93c5fd; }
        .dark .notice-warn { background: #1c120720; border-color: #92400e; color: #fcd34d; }

        /* ── COMPENSATION CARD ────────────────────────── */
        .pay-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            border-radius: 10px;
            background: var(--page-bg);
        }

        .pay-label { font-size: 0.82rem; color: var(--text-secondary); }
        .pay-amount { font-size: 0.95rem; font-weight: 700; font-family: 'DM Mono', monospace; }
        .pay-gross { color: #15803d; }
        .pay-net { color: #2563eb; }
        .dark .pay-gross { color: #86efac; }
        .dark .pay-net { color: #60a5fa; }

        /* ── COMPLETION CHIP ──────────────────────────── */
        .completion-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.72rem;
            font-weight: 700;
        }

        .chip-incomplete {
            background: #fffbeb;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .chip-complete {
            background: #dcfce7;
            color: #15803d;
            border: 1px solid #bbf7d0;
        }

        .dark .chip-incomplete { background: #1c1207; color: #fcd34d; border-color: #92400e; }
        .dark .chip-complete { background: #052e16; color: #86efac; border-color: #166534; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 9px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }

        /* Divider */
        .divider { border: none; border-top: 1px solid var(--card-border); margin: 1rem 0; }

        /* Sidebar */
        .sidebar-item { transition: all 0.2s ease; position: relative; }
        .sidebar-item.active {
            background: rgba(59,130,246,0.08); color: #2563eb;
            border-left: 3px solid #2563eb; font-weight: 500;
        }
        .sidebar-item:hover:not(.active) { background: rgba(59,130,246,0.04); }
        .dark .sidebar-item.active { background: rgba(59,130,246,0.15); color: #60a5fa; }

        .sidebar-container {
            position: fixed; top: 0; left: 0;
            height: 100vh; width: 16rem; z-index: 40; overflow-y: auto;
        }
        .main-content { margin-left: 16rem; width: calc(100% - 16rem); min-height: 100vh; }

        @media (max-width: 1023px) {
            .sidebar-container { transform: translateX(-100%); }
            .sidebar-container.open { transform: translateX(0); }
            .main-content { margin-left: 0; width: 100%; }
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fadeup { animation: fadeUp 0.35s ease forwards; }
        .delay-1 { animation-delay: 0.05s; opacity: 0; }
        .delay-2 { animation-delay: 0.1s; opacity: 0; }
        .delay-3 { animation-delay: 0.15s; opacity: 0; }
        .delay-4 { animation-delay: 0.2s; opacity: 0; }

        /* Empty state field indicator */
        .field-empty-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.78rem;
            color: var(--empty-text);
            font-style: italic;
        }

        .field-empty-indicator .material-icons-round { font-size: 0.85rem; }

        /* Bank section special */
        .bank-card-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1d4ed8 100%);
            border-radius: 1.25rem 1.25rem 0 0;
            padding: 1.25rem 1.5rem;
            color: white;
        }

        .dark .bank-card-header { background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); }

        /* Close btn */
        .close-btn {
            width: 32px; height: 32px;
            border-radius: 8px;
            background: var(--page-bg);
            border: 1px solid var(--card-border);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: background 0.15s;
            color: var(--text-secondary);
        }
        .close-btn:hover { background: var(--card-border); }
    </style>
</head>
<body>

<main layout:fragment="content">

    <!-- ── PROFILE HEADER CARD ────────────────────────────────────── -->
    <div class="card p-5 md:p-6 mb-6 animate-fadeup delay-1">
        <div class="flex flex-col md:flex-row md:items-start gap-5">
            <!-- Avatar -->
            <div class="flex-shrink-0">
                <div class="relative" id="avatarWrapper">

                    <!-- PLACEHOLDER shown when no photo is uploaded -->
                    <div id="avatarPlaceholder"
                         class="avatar-placeholder pulse-dash w-24 h-24 md:w-28 md:h-28"
                         title="Click to upload your profile photo">
                        <span th:text="${employee.firstName.substring(0,1) + employee.lastName.substring(0,1)}" class="avatar-initials" style="font-size:1.65rem">JO</span>
                        <span class="avatar-upload-hint" style="font-size:0.6rem;margin-top:2px">Add photo</span>
                    </div>

                    <!-- ACTUAL PHOTO — hidden until an image is uploaded -->
                    <img id="avatarImage"
                         src=""
                         alt="Profile photo"
                         class="w-24 h-24 md:w-28 md:h-28 avatar-ring"
                         style="display:none">

                    <!-- Camera button — always visible -->
                    <button id="editPhotoBtn"
                            class="absolute -bottom-1 -right-1 w-8 h-8 bg-white dark:bg-gray-800 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center hover:bg-blue-50 dark:hover:bg-blue-900/30 transition-colors z-10">
                        <span class="material-icons-round text-blue-600 dark:text-blue-400" style="font-size:0.9rem">camera_alt</span>
                    </button>
                </div>
            </div>

            <!-- Info -->
            <div class="flex-1">
                <div class="flex flex-col md:flex-row md:items-start justify-between gap-3">
                    <div>
                        <h2 th:text="${employee.firstName + ' ' + employee.lastName}"
                            class="text-2xl md:text-3xl font-bold" style="color: var(--text-primary); letter-spacing: -0.02em;">Jane Okafor</h2>
                        <div class="flex flex-wrap items-center gap-2 mt-2">
                            <span th:text="${employee.jobStep.jobGrade.name + ' · ' + employee.jobStep.name}"
                                  class="badge badge-grade">Grade 3 · Step 2</span>
                            <span class="badge badge-active">Active</span>
                            <span class="flex items-center gap-1 text-xs" style="color: var(--text-muted);">
                                <span class="material-icons-round" style="font-size: 0.8rem">badge</span>
                                <span th:text="${employee.employeeNumber}" style="font-family: 'DM Mono', monospace;">EMP-2021-042</span>
                            </span>
                        </div>
                    </div>
                    <button id="editProfileBtn" class="edit-btn edit-btn-primary flex-shrink-0 self-start">
                        <span class="material-icons-round" style="font-size:0.9rem">edit</span> Edit Profile
                    </button>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-5 pt-4" style="border-top: 1px solid var(--card-border)">
                    <div class="flex items-center gap-2">
                        <span class="material-icons-round text-sm" style="color: var(--text-muted)">business</span>
                        <div>
                            <p class="info-label">Department</p>
                            <p th:text="${employee.department.name}" class="info-value text-sm">Marketing</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="material-icons-round text-sm" style="color: var(--text-muted)">calendar_today</span>
                        <div>
                            <p class="info-label">Date of Hire</p>
                            <p th:text="${#temporals.format(employee.createdAt, 'dd MMM yyyy')}" class="info-value text-sm">12 Apr 2021</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="material-icons-round text-sm" style="color: var(--text-muted)">mail_outline</span>
                        <div>
                            <p class="info-label">Email</p>
                            <p th:text="${employee.email}" class="info-value text-sm"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="355f545b5075565a5845545b4c1b565a58">[email&#160;protected]</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ── LEGEND ─────────────────────────────────────────────────── -->
    <div class="flex flex-wrap items-center gap-3 mb-5 animate-fadeup delay-2">
        <span class="text-xs font-600" style="color: var(--text-muted)">Field types:</span>
        <span class="field-pill pill-system">
            <span class="material-icons-round" style="font-size:0.7rem">lock</span> System-managed
        </span>
        <span class="field-pill pill-employee">
            <span class="material-icons-round" style="font-size:0.7rem">edit</span> You can edit
        </span>
    </div>

    <!-- ── MAIN GRID ──────────────────────────────────────────────── -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fadeup delay-3">

        <!-- LEFT COLUMN -->
        <div class="lg:col-span-2 space-y-6">

            <!-- ========== PERSONAL INFORMATION ========== -->
            <div class="card p-5 md:p-6">
                <div class="section-header">
                    <div class="section-title-group">
                        <div class="section-icon blue">
                            <span class="material-icons-round" style="font-size:1.1rem">person_outline</span>
                        </div>
                        <div>
                            <p class="section-title">Personal Information</p>
                            <p class="text-xs mt-0.5" style="color: var(--text-muted)">Mix of system & your personal data</p>
                        </div>
                    </div>
                    <button id="editPersonalInfoBtn" class="edit-btn edit-btn-ghost">
                        <span class="material-icons-round" style="font-size:0.85rem">edit</span> Edit
                    </button>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                    <!-- System fields -->
                    <div class="info-item system-field">
                        <p class="info-label">Full Name</p>
                        <div class="info-value-wrapper">
                            <p th:text="${employee.firstName + ' ' + employee.lastName}" class="info-value">Jane Okafor</p>
                            <span class="field-pill pill-system"><span class="material-icons-round" style="font-size:0.65rem">lock</span> System</span>
                        </div>
                    </div>
                    <div class="info-item system-field">
                        <p class="info-label">Email Address</p>
                        <div class="info-value-wrapper">
                            <p th:text="${employee.email}" class="info-value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e389828d86cd8c8882858c91a3808c8e93828d9acd808c8e">[email&#160;protected]</a></p>
                            <span class="field-pill pill-system"><span class="material-icons-round" style="font-size:0.65rem">lock</span> System</span>
                        </div>
                    </div>
                    <div class="info-item system-field">
                        <p class="info-label">Phone Number</p>
                        <div class="info-value-wrapper">
                            <p th:text="${employee.phoneNumber}" class="info-value">+234 801 234 5678</p>
                            <span class="field-pill pill-system"><span class="material-icons-round" style="font-size:0.65rem">lock</span> System</span>
                        </div>
                    </div>

                    <!-- Employee-fillable fields -->
                    <div class="info-item">
                        <p class="info-label">Date of Birth</p>
                        <div class="info-value-wrapper">
                            <p th:if="${employee.dateOfBirth != null}" th:text="${#temporals.format(employee.dateOfBirth, 'dd MMM yyyy')}" class="info-value"></p>
                            <p th:unless="${employee.dateOfBirth != null}" class="info-value empty field-empty-indicator" data-field="dob">
                                <span class="material-icons-round">warning_amber</span> Not yet provided
                            </p>
                            <span class="field-pill pill-employee"><span class="material-icons-round" style="font-size:0.65rem">edit</span> Yours</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <p class="info-label">Gender</p>
                        <div class="info-value-wrapper">
                            <p th:if="${employee.gender != null}" th:text="${employee.gender}" class="info-value"></p>
                            <p th:unless="${employee.gender != null}" class="info-value empty field-empty-indicator" data-field="gender">
                                <span class="material-icons-round">warning_amber</span> Not yet provided
                            </p>
                            <span class="field-pill pill-employee"><span class="material-icons-round" style="font-size:0.65rem">edit</span> Yours</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <p class="info-label">Marital Status</p>
                        <div class="info-value-wrapper">
                            <p th:if="${employee.maritalStatus != null}" th:text="${employee.maritalStatus}" class="info-value"></p>
                            <p th:unless="${employee.maritalStatus != null}" class="info-value empty field-empty-indicator" data-field="marital">
                                <span class="material-icons-round">warning_amber</span> Not yet provided
                            </p>
                            <span class="field-pill pill-employee"><span class="material-icons-round" style="font-size:0.65rem">edit</span> Yours</span>
                        </div>
                    </div>
                    <div class="info-item sm:col-span-2">
                        <p class="info-label">Residential Address</p>
                        <div class="info-value-wrapper">
                            <p th:if="${employee.residentialAddress != null}" th:text="${employee.residentialAddress}" class="info-value"></p>
                            <p th:unless="${employee.residentialAddress != null}" class="info-value empty field-empty-indicator" data-field="address">
                                <span class="material-icons-round">warning_amber</span> Not yet provided
                            </p>
                            <span class="field-pill pill-employee"><span class="material-icons-round" style="font-size:0.65rem">edit</span> Yours</span>
                        </div>
                    </div>
                    <!-- NEW: Mission field -->
                    <div class="info-item sm:col-span-2">
                        <p class="info-label">My Mission</p>
                        <div class="info-value-wrapper">
                            <p th:if="${employee.mission != null}" th:text="${employee.mission}" class="info-value"></p>
                            <p th:unless="${employee.mission != null}" class="info-value empty field-empty-indicator" data-field="mission">
                                <span class="material-icons-round">warning_amber</span> Not yet provided
                            </p>
                            <span class="field-pill pill-employee"><span class="material-icons-round" style="font-size:0.65rem">edit</span> Yours</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employment Details (unchanged) -->
            <div class="card p-5 md:p-6">
                <div class="section-header">
                    <div class="section-title-group">
                        <div class="section-icon purple">
                            <span class="material-icons-round" style="font-size:1.1rem">work_outline</span>
                        </div>
                        <div>
                            <p class="section-title">Employment Details</p>
                            <p class="text-xs mt-0.5" style="color: var(--text-muted)">Managed by HR — view only</p>
                        </div>
                    </div>
                    <span class="field-pill pill-system">
                        <span class="material-icons-round" style="font-size:0.7rem">lock</span> HR Managed
                    </span>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                    <div class="info-item system-field">
                        <p class="info-label">Employee Number</p>
                        <p th:text="${employee.employeeNumber}" class="info-value" style="font-family:'DM Mono',monospace;">EMP-2021-042</p>
                    </div>
                    <div class="info-item system-field">
                        <p class="info-label">Employment Status</p>
                        <p class="info-value"><span class="badge badge-active" style="font-size:0.68rem">Active</span> · Permanent</p>
                    </div>
                    <div class="info-item system-field">
                        <p class="info-label">Date of Hire</p>
                        <p th:text="${#temporals.format(employee.createdAt, 'dd MMMM yyyy')}" class="info-value">12 April 2021</p>
                    </div>
                    <div class="info-item system-field">
                        <p class="info-label">Probation End Date</p>
                        <p class="info-value">11 Oct 2021 <span class="text-xs text-green-600 dark:text-green-400 font-medium">(Completed)</span></p>
                    </div>
                    <div class="info-item system-field">
                        <p class="info-label">Department</p>
                        <p th:text="${employee.department.name}" class="info-value">Marketing</p>
                    </div>
                    <div class="info-item system-field">
                        <p class="info-label">Job Grade / Step</p>
                        <p th:text="${employee.jobStep.jobGrade.name + ' · ' + employee.jobStep.name}" class="info-value">Grade 3 · Step 2</p>
                    </div>
                    <div class="info-item system-field">
                        <p class="info-label">Pay Group</p>
                        <p class="info-value">PG4 - Marketing</p>
                    </div>
                    <div class="info-item system-field">
                        <p class="info-label">Reports To</p>
                        <p class="info-value">Michael Adenuga</p>
                        <p class="text-xs mt-0.5" style="color: var(--text-muted)">Marketing Manager</p>
                    </div>
                    <div class="info-item system-field sm:col-span-2">
                        <p class="info-label">Work Location</p>
                        <p class="info-value">Lagos HQ</p>
                    </div>
                </div>

                <div class="notice notice-info mt-5">
                    <span class="material-icons-round" style="font-size:1rem;flex-shrink:0">info</span>
                    <span>Employment details are managed by HR. Contact HR to request any changes.</span>
                </div>
            </div>

            <!-- ========== EMERGENCY CONTACT ========== -->
            <div class="card overflow-hidden">
                <div class="p-5 md:p-6">
                    <div class="section-header">
                        <div class="section-title-group">
                            <div class="section-icon rose">
                                <span class="material-icons-round" style="font-size:1.1rem">contact_emergency</span>
                            </div>
                            <div>
                                <p class="section-title">Emergency Contact</p>
                                <p class="text-xs mt-0.5" style="color: var(--text-muted)">Provided and managed by you</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span id="emergencyStatus" class="completion-chip"
                                  th:classappend="${employee.emergencyContact != null ? 'chip-complete' : 'chip-incomplete'}">
                                <span class="material-icons-round" style="font-size:0.75rem"
                                      th:text="${employee.emergencyContact != null ? 'check_circle' : 'warning_amber'}">warning_amber</span>
                                <span th:text="${employee.emergencyContact != null ? 'Complete' : 'Incomplete'}">Incomplete</span>
                            </span>
                            <button id="editEmergencyBtn" class="edit-btn"
                                    th:classappend="${employee.emergencyContact != null ? 'edit-btn-ghost' : 'edit-btn-fill'}">
                                <span class="material-icons-round" style="font-size:0.85rem"
                                      th:text="${employee.emergencyContact != null ? 'edit' : 'add'}">add</span>
                                <span th:text="${employee.emergencyContact != null ? 'Edit' : 'Add Details'}">Add Details</span>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-5" id="emergencyContent">
                        <div class="info-item">
                            <p class="info-label">Full Name</p>
                            <p th:if="${employee.emergencyContact != null}" th:text="${employee.emergencyContact.contactName}" class="info-value"></p>
                            <p th:unless="${employee.emergencyContact != null}" class="info-value empty field-empty-indicator">
                                <span class="material-icons-round">warning_amber</span>Not provided
                            </p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">Relationship</p>
                            <p th:if="${employee.emergencyContact != null}" th:text="${employee.emergencyContact.relationship}" class="info-value"></p>
                            <p th:unless="${employee.emergencyContact != null}" class="info-value empty field-empty-indicator">
                                <span class="material-icons-round">warning_amber</span>Not provided
                            </p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">Phone Number</p>
                            <p th:if="${employee.emergencyContact != null}" th:text="${employee.emergencyContact.phoneNumber}" class="info-value"></p>
                            <p th:unless="${employee.emergencyContact != null}" class="info-value empty field-empty-indicator">
                                <span class="material-icons-round">warning_amber</span>Not provided
                            </p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">Alternative Phone</p>
                            <p th:if="${employee.emergencyContact != null and employee.emergencyContact.alternativePhoneNumber != null}"
                               th:text="${employee.emergencyContact.alternativePhoneNumber}" class="info-value"></p>
                            <p th:unless="${employee.emergencyContact != null and employee.emergencyContact.alternativePhoneNumber != null}"
                               class="info-value empty field-empty-indicator">
                                <span class="material-icons-round">warning_amber</span>Not provided
                            </p>
                        </div>
                    </div>

                    <div class="notice notice-warn mt-5" th:unless="${employee.emergencyContact != null}">
                        <span class="material-icons-round" style="font-size:1rem;flex-shrink:0">warning</span>
                        <span>Please add an emergency contact. This is important for your safety and welfare.</span>
                    </div>
                    <div class="notice notice-info mt-5" th:if="${employee.emergencyContact != null}">
                        <span class="material-icons-round" style="font-size:1rem;flex-shrink:0">check_circle</span>
                        <span>Emergency contact saved. You can update it anytime.</span>
                    </div>
                </div>
            </div>

        </div><!-- end left col -->

        <!-- RIGHT COLUMN (unchanged) -->
        <div class="space-y-6 animate-fadeup delay-4">

            <!-- Compensation (HR-managed) -->
            <div class="card p-5">
                <div class="section-header">
                    <div class="section-title-group">
                        <div class="section-icon green">
                            <span class="material-icons-round" style="font-size:1.1rem">payments</span>
                        </div>
                        <p class="section-title">Compensation</p>
                    </div>
                    <span class="field-pill pill-system">
                        <span class="material-icons-round" style="font-size:0.7rem">lock</span> HR
                    </span>
                </div>
                <div class="space-y-2">
                    <div class="pay-row">
                        <span class="pay-label">Basic Salary</span>
                        <span class="pay-amount" style="color:var(--text-primary)">₦450,000</span>
                    </div>
                    <div class="pay-row">
                        <span class="pay-label">Gross Pay</span>
                        <span class="pay-amount pay-gross">₦620,000</span>
                    </div>
                    <div class="pay-row">
                        <span class="pay-label">Net Pay</span>
                        <span class="pay-amount pay-net">₦540,000</span>
                    </div>
                </div>
                <div class="mt-4 pt-3" style="border-top: 1px solid var(--card-border)">
                    <a href="#" class="flex items-center justify-between text-sm font-semibold text-blue-600 dark:text-blue-400 hover:text-blue-700 transition-colors">
                        View Full Payslip
                        <span class="material-icons-round text-sm">arrow_forward</span>
                    </a>
                </div>
            </div>

            <!-- Bank Details (unchanged) -->
            <div class="card overflow-hidden">
                <div class="bank-card-header">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="material-icons-round text-blue-200" style="font-size:1.3rem">account_balance</span>
                            <div>
                                <p style="font-size:0.8rem;font-weight:700;text-transform:uppercase;letter-spacing:0.05em;opacity:0.7">Bank Details</p>
                                <p style="font-size:0.7rem;opacity:0.6;margin-top:2px">Provided and managed by you</p>
                            </div>
                        </div>
                        <span class="field-pill" style="background:rgba(255,255,255,0.15);color:white;border:1px solid rgba(255,255,255,0.25)">
                            <span class="material-icons-round" style="font-size:0.65rem">edit</span> Yours
                        </span>
                    </div>
                </div>
                <div class="p-5">
                    <div id="bankStatus" class="flex items-center justify-between mb-4">
                        <span class="completion-chip chip-incomplete">
                            <span class="material-icons-round" style="font-size:0.75rem">warning_amber</span>
                            Not set up yet
                        </span>
                        <button id="editBankBtn" class="edit-btn edit-btn-fill">
                            <span class="material-icons-round" style="font-size:0.85rem">add</span> Add Bank Details
                        </button>
                    </div>

                    <div class="space-y-4" id="bankContent">
                        <div class="info-item">
                            <p class="info-label">Account Holder</p>
                            <!-- th:text="${employee.bankDetails.accountHolder}" -->
                            <p class="info-value empty field-empty-indicator"><span class="material-icons-round">warning_amber</span>Not provided</p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">Bank Name</p>
                            <p class="info-value empty field-empty-indicator"><span class="material-icons-round">warning_amber</span>Not provided</p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">Account Number</p>
                            <p class="info-value empty field-empty-indicator"><span class="material-icons-round">warning_amber</span>Not provided</p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">Account Type</p>
                            <p class="info-value empty field-empty-indicator"><span class="material-icons-round">warning_amber</span>Not provided</p>
                        </div>
                    </div>

                    <div class="notice notice-warn mt-4">
                        <span class="material-icons-round" style="font-size:1rem;flex-shrink:0">warning</span>
                        <span>Bank details are required for salary payments. Please add your details to avoid delays.</span>
                    </div>
                </div>
            </div>

            <!-- Documents (unchanged) -->
            <div class="card p-5">
                <div class="section-header">
                    <div class="section-title-group">
                        <div class="section-icon amber">
                            <span class="material-icons-round" style="font-size:1.1rem">description</span>
                        </div>
                        <p class="section-title">Documents</p>
                    </div>
                </div>
                <div class="space-y-1">
                    <a href="#" class="flex items-center gap-3 p-2.5 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                        <span class="material-icons-round text-red-500" style="font-size:1.1rem">picture_as_pdf</span>
                        <span class="text-sm font-medium flex-1" style="color:var(--text-primary)">Employment Contract.pdf</span>
                        <span class="material-icons-round text-sm" style="color:var(--text-muted)">download</span>
                    </a>
                    <a href="#" class="flex items-center gap-3 p-2.5 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                        <span class="material-icons-round text-blue-500" style="font-size:1.1rem">image</span>
                        <span class="text-sm font-medium flex-1" style="color:var(--text-primary)">ID Card.jpg</span>
                        <span class="material-icons-round text-sm" style="color:var(--text-muted)">download</span>
                    </a>
                    <a href="#" class="flex items-center gap-3 p-2.5 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                        <span class="material-icons-round text-green-500" style="font-size:1.1rem">description</span>
                        <span class="text-sm font-medium flex-1" style="color:var(--text-primary)">Tax Certificate.pdf</span>
                        <span class="material-icons-round text-sm" style="color:var(--text-muted)">download</span>
                    </a>
                </div>
                <div class="mt-3 pt-3" style="border-top: 1px solid var(--card-border)">
                    <a href="#" class="flex items-center justify-between text-sm font-semibold text-blue-600 dark:text-blue-400">
                        View All Documents
                        <span class="material-icons-round text-sm">arrow_forward</span>
                    </a>
                </div>
            </div>

        </div><!-- end right col -->
    </div>

    <!-- Recent Activity (unchanged) -->
    <div class="card p-5 md:p-6 mt-6">
        <div class="section-header">
            <div class="section-title-group">
                <div class="section-icon blue">
                    <span class="material-icons-round" style="font-size:1.1rem">history</span>
                </div>
                <p class="section-title">Recent Activity</p>
            </div>
            <a href="#" class="text-sm font-semibold text-blue-600 dark:text-blue-400">View All</a>
        </div>
        <div class="space-y-3">
            <div class="flex items-center justify-between p-3 rounded-xl" style="background:var(--page-bg)">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                        <span class="material-icons-round text-green-600 dark:text-green-400" style="font-size:0.9rem">check</span>
                    </div>
                    <div>
                        <p class="text-sm font-semibold" style="color:var(--text-primary)">Leave approved</p>
                        <p class="text-xs mt-0.5" style="color:var(--text-muted)">Annual PTO · 5 days (21–25 Mar 2025)</p>
                    </div>
                </div>
                <span class="text-xs" style="color:var(--text-muted)">2 days ago</span>
            </div>
            <div class="flex items-center justify-between p-3 rounded-xl" style="background:var(--page-bg)">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                        <span class="material-icons-round text-blue-600 dark:text-blue-400" style="font-size:0.9rem">trending_up</span>
                    </div>
                    <div>
                        <p class="text-sm font-semibold" style="color:var(--text-primary)">Promotion approved</p>
                        <p class="text-xs mt-0.5" style="color:var(--text-muted)">Grade 2 → Grade 3 · Step 2</p>
                    </div>
                </div>
                <span class="text-xs" style="color:var(--text-muted)">01 Jun 2024</span>
            </div>
        </div>
    </div>

    <!-- ========== MODALS ========== -->

    <!-- Modal: Edit Photo (unchanged) -->
    <div id="editPhotoModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Update Profile Photo</p>
                    <p class="modal-subtitle">JPG, PNG or GIF · max 5MB</p>
                </div>
                <button class="close-btn close-modal"><span class="material-icons-round" style="font-size:1rem">close</span></button>
            </div>
            <div class="modal-body space-y-5">
                <div class="flex justify-center">
                    <div class="relative flex flex-col items-center gap-3">
                        <div id="modalAvatarPlaceholder"
                             class="avatar-placeholder avatar-placeholder-lg w-28 h-28">
                            <span class="material-icons-round" style="font-size:2rem;color:#2563eb;opacity:0.5">person</span>
                            <span id="modalAvatarInitials" class="avatar-initials" style="font-size:1.8rem">JO</span>
                            <span class="avatar-upload-hint">No photo yet</span>
                        </div>
                        <img id="modalAvatarImage"
                             src=""
                             alt="Profile preview"
                             class="w-28 h-28 avatar-ring"
                             style="display:none">
                        <span id="photoFilename" class="text-xs font-medium" style="color:var(--text-muted);display:none"></span>
                    </div>
                </div>
                <label class="w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-sm font-semibold cursor-pointer transition-colors">
                    <span class="material-icons-round" style="font-size:1rem">upload</span>
                    Choose New Photo
                    <input type="file" accept="image/*" class="hidden">
                </label>
            </div>
            <div class="modal-footer">
                <button class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                <button class="edit-btn edit-btn-primary">Save Photo</button>
            </div>
        </div>
    </div>

    <!-- Modal: Edit Profile Header (unchanged) -->
    <div id="editProfileModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Edit Profile</p>
                    <p class="modal-subtitle">Update your basic profile information</p>
                </div>
                <button class="close-btn close-modal"><span class="material-icons-round" style="font-size:1rem">close</span></button>
            </div>
            <div class="modal-body space-y-4">
                <div class="notice notice-info">
                    <span class="material-icons-round" style="font-size:1rem;flex-shrink:0">info</span>
                    <span>Name and employee number are managed by HR and cannot be changed here.</span>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-label">First Name <span class="field-pill pill-system ml-1"><span class="material-icons-round" style="font-size:0.6rem">lock</span></span></label>
                        <input type="text" th:value="${employee.firstName}" value="Jane" class="form-input" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last Name <span class="field-pill pill-system ml-1"><span class="material-icons-round" style="font-size:0.6rem">lock</span></span></label>
                        <input type="text" th:value="${employee.lastName}" value="Okafor" class="form-input" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Job Title</label>
                    <input type="text" value="Marketing Specialist" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Department <span class="field-pill pill-system ml-1"><span class="material-icons-round" style="font-size:0.6rem">lock</span></span></label>
                    <input type="text" th:value="${employee.department.name}" value="Marketing" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Employee Number <span class="field-pill pill-system ml-1"><span class="material-icons-round" style="font-size:0.6rem">lock</span></span></label>
                    <input type="text" th:value="${employee.employeeNumber}" value="EMP-2021-042" class="form-input" readonly style="font-family:'DM Mono',monospace">
                </div>
            </div>
            <div class="modal-footer">
                <button class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                <button class="edit-btn edit-btn-primary">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL: EDIT PERSONAL INFORMATION ========== -->
    <div id="editPersonalInfoModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Edit Personal Information</p>
                    <p class="modal-subtitle">Update your personal details and mission</p>
                </div>
                <button class="close-btn close-modal"><span class="material-icons-round" style="font-size:1rem">close</span></button>
            </div>
            <form th:action="@{/employee/update-personal-info}" method="post" th:object="${employee}">
                <div class="modal-body space-y-4">
                    <div class="notice notice-info">
                        <span class="material-icons-round" style="font-size:1rem;flex-shrink:0">info</span>
                        <span>Name, email, and phone are managed by HR. You can update your personal details below.</span>
                    </div>

                    <input type="hidden" th:field="*{id}" />

                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Full Name <span class="field-pill pill-system ml-1"><span class="material-icons-round" style="font-size:0.6rem">lock</span></span></label>
                            <input type="text" th:value="*{firstName} + ' ' + *{lastName}" class="form-input" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Address <span class="field-pill pill-system ml-1"><span class="material-icons-round" style="font-size:0.6rem">lock</span></span></label>
                            <input type="email" th:value="*{email}" class="form-input" readonly>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phone Number <span class="field-pill pill-system ml-1"><span class="material-icons-round" style="font-size:0.6rem">lock</span></span></label>
                        <input type="tel" th:value="*{phoneNumber}" class="form-input" readonly>
                    </div>

                    <hr class="divider">
                    <p class="text-xs font-semibold uppercase tracking-widest" style="color:var(--text-muted)">Your Personal Details</p>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Date of Birth <span class="field-pill pill-employee ml-1"><span class="material-icons-round" style="font-size:0.6rem">edit</span></span></label>
                            <input type="date" th:field="*{dateOfBirth}" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Gender <span class="field-pill pill-employee ml-1"><span class="material-icons-round" style="font-size:0.6rem">edit</span></span></label>
                            <select th:field="*{gender}" class="form-input">
                                <option value="">Select gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Prefer not to say">Prefer not to say</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Marital Status <span class="field-pill pill-employee ml-1"><span class="material-icons-round" style="font-size:0.6rem">edit</span></span></label>
                        <select th:field="*{maritalStatus}" class="form-input">
                            <option value="">Select status</option>
                            <option value="Single">Single</option>
                            <option value="Married">Married</option>
                            <option value="Divorced">Divorced</option>
                            <option value="Widowed">Widowed</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Residential Address <span class="field-pill pill-employee ml-1"><span class="material-icons-round" style="font-size:0.6rem">edit</span></span></label>
                        <textarea th:field="*{residentialAddress}" class="form-input" placeholder="Enter your residential address..."></textarea>
                    </div>

                    <!-- NEW: Mission field -->
                    <div class="form-group">
                        <label class="form-label">My Mission <span class="field-pill pill-employee ml-1"><span class="material-icons-round" style="font-size:0.6rem">edit</span></span></label>
                        <textarea th:field="*{mission}" class="form-input" placeholder="What is your personal mission at work?" rows="3"></textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                    <button type="submit" class="edit-btn edit-btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== MODAL: EDIT EMERGENCY CONTACT ========== -->
    <div id="editEmergencyModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Emergency Contact</p>
                    <p class="modal-subtitle">All fields are provided and managed by you</p>
                </div>
                <button type="button" class="close-btn close-modal">
                    <span class="material-icons-round" style="font-size:1rem">close</span>
                </button>
            </div>
            <form th:action="@{/add-emergency-contact}" method="post" th:object="${employee.emergencyContact != null ? employee.emergencyContact : new com.justjava.humanresource.hr.entity.EmergencyContact()}">
                <div class="modal-body space-y-4">
                    <div class="notice notice-warn">
                        <span class="material-icons-round" style="font-size:1rem;flex-shrink:0">emergency</span>
                        <span>This person will be contacted in case of an emergency. Please ensure accuracy.</span>
                    </div>

                    <input type="hidden" name="id" th:value="${employee.id}" />

                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Full Name *</label>
                            <input type="text"
                                   name="emergencyContactName"
                                   th:value="${employee.emergencyContact?.contactName}"
                                   class="form-input"
                                   placeholder="e.g. Chidi Okafor"
                                   required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Relationship *</label>
                            <select name="emergencyRelationship"
                                    class="form-input"
                                    required>
                                <option value="">Select relationship</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Spouse'}" value="Spouse">Spouse</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Parent'}" value="Parent">Parent</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Sibling'}" value="Sibling">Sibling</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Child'}" value="Child">Child</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Friend'}" value="Friend">Friend</option>
                                <option th:selected="${employee.emergencyContact?.relationship == 'Other'}" value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <input type="tel"
                               name="emergencyPhoneNumber"
                               th:value="${employee.emergencyContact?.phoneNumber}"
                               class="form-input"
                               placeholder="+234 8XX XXX XXXX"
                               required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Alternative Phone</label>
                        <input type="tel"
                               name="emergencyAlternativePhoneNumber"
                               th:value="${employee.emergencyContact?.alternativePhoneNumber}"
                               class="form-input"
                               placeholder="+234 8XX XXX XXXX (optional)">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                    <button type="submit" class="edit-btn edit-btn-primary">Save Contact</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Edit Bank Details (unchanged) -->
    <div id="editBankModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <p class="modal-title">Bank Details</p>
                    <p class="modal-subtitle">All fields are provided and managed by you</p>
                </div>
                <button class="close-btn close-modal"><span class="material-icons-round" style="font-size:1rem">close</span></button>
            </div>
            <div class="modal-body space-y-4">
                <div class="notice notice-warn">
                    <span class="material-icons-round" style="font-size:1rem;flex-shrink:0">account_balance</span>
                    <span>Your salary will be paid to this account. Ensure all details are accurate before saving.</span>
                </div>
                <div class="form-group">
                    <label class="form-label">Account Holder Name *</label>
                    <!-- th:value="${employee.bankDetails.accountHolder}" -->
                    <input type="text" name="accountHolder" class="form-input" placeholder="Full name as on bank account">
                </div>
                <div class="form-group">
                    <label class="form-label">Bank Name *</label>
                    <!-- th:value="${employee.bankDetails.bankName}" -->
                    <select name="bankName" class="form-input">
                        <option value="">Select your bank</option>
                        <option>Access Bank</option>
                        <option>First Bank of Nigeria</option>
                        <option>Guaranty Trust Bank (GTBank)</option>
                        <option>United Bank for Africa (UBA)</option>
                        <option>Zenith Bank</option>
                        <option>Stanbic IBTC Bank</option>
                        <option>Fidelity Bank</option>
                        <option>Union Bank</option>
                        <option>Sterling Bank</option>
                        <option>Wema Bank</option>
                        <option>Ecobank Nigeria</option>
                        <option>Opay</option>
                        <option>Kuda Bank</option>
                        <option>Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Account Number *</label>
                    <!-- th:value="${employee.bankDetails.accountNumber}" -->
                    <input type="text" name="accountNumber" maxlength="10" class="form-input" placeholder="10-digit NUBAN account number" style="font-family:'DM Mono',monospace;letter-spacing:0.05em">
                </div>
                <div class="form-group">
                    <label class="form-label">Account Type *</label>
                    <!-- th:value="${employee.bankDetails.accountType}" -->
                    <select name="accountType" class="form-input">
                        <option value="">Select account type</option>
                        <option>Savings</option>
                        <option>Current</option>
                        <option>Domiciliary</option>
                    </select>
                </div>
                <div class="notice notice-info" style="margin-top:8px">
                    <span class="material-icons-round" style="font-size:1rem;flex-shrink:0">security</span>
                    <span>Your bank details are encrypted and used only for salary payments. Only the last 4 digits will be displayed publicly.</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="edit-btn edit-btn-ghost close-modal">Cancel</button>
                <button class="edit-btn edit-btn-primary" onclick="saveBank()">Save Bank Details</button>
            </div>
        </div>
    </div>

    <!-- ─── SCRIPTS ────────────────────────────────────────────── -->
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script>
        function disableSubmitButton(form) {
            const submitButton = form.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            }
            return true; // Allow form submission
        }

        // ── MODAL ENGINE ─────────────────────────────────────────
        const modals = {
            editPhoto: document.getElementById('editPhotoModal'),
            editProfile: document.getElementById('editProfileModal'),
            editPersonalInfo: document.getElementById('editPersonalInfoModal'),
            editEmergency: document.getElementById('editEmergencyModal'),
            editBank: document.getElementById('editBankModal'),
        };

        function openModal(modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modal) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Open triggers
        document.getElementById('editPhotoBtn').addEventListener('click', () => openModal(modals.editPhoto));
        document.getElementById('editProfileBtn').addEventListener('click', () => openModal(modals.editProfile));
        document.getElementById('editPersonalInfoBtn').addEventListener('click', () => openModal(modals.editPersonalInfo));
        document.getElementById('editEmergencyBtn').addEventListener('click', () => openModal(modals.editEmergency));
        document.getElementById('editBankBtn').addEventListener('click', () => openModal(modals.editBank));

        // Close via .close-modal buttons
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', e => {
                const overlay = e.target.closest('.modal-overlay');
                if (overlay) closeModal(overlay);
            });
        });

        // Close on overlay click
        Object.values(modals).forEach(modal => {
            modal.addEventListener('click', e => { if (e.target === modal) closeModal(modal); });
        });
        document.querySelectorAll('.modal-container').forEach(c => c.addEventListener('click', e => e.stopPropagation()));

        // Escape key
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') Object.values(modals).forEach(m => closeModal(m));
        });

        // ── AVATAR INITIALS ──────────────────────────────────────
        function getInitials(fullName) {
            const parts = (fullName || '').trim().split(/\s+/);
            if (parts.length === 0 || !parts[0]) return '?';
            if (parts.length === 1) return parts[0][0].toUpperCase();
            return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
        }

        const nameEl = document.querySelector('h2');
        const employeeName = nameEl ? nameEl.textContent.trim() : 'Jane Okafor';
        const initials = getInitials(employeeName);

        const modalInitialsEl = document.getElementById('modalAvatarInitials');
        if (modalInitialsEl) modalInitialsEl.textContent = initials;

        // ── PHOTO UPLOAD PREVIEW ─────────────────────────────────
        const photoInput = document.querySelector('#editPhotoModal input[type="file"]');
        const avatarPlaceholder = document.getElementById('avatarPlaceholder');
        const avatarImage = document.getElementById('avatarImage');
        const modalPlaceholder = document.getElementById('modalAvatarPlaceholder');
        const modalImage = document.getElementById('modalAvatarImage');
        const filenameLabel = document.getElementById('photoFilename');

        if (photoInput) {
            photoInput.addEventListener('change', function () {
                const file = this.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function (e) {
                    const src = e.target.result;

                    if (modalImage) {
                        modalImage.src = src;
                        modalImage.style.display = '';
                    }
                    if (modalPlaceholder) modalPlaceholder.style.display = 'none';
                    if (filenameLabel) {
                        filenameLabel.textContent = file.name;
                        filenameLabel.style.display = '';
                    }

                    photoInput._pendingSrc = src;
                };
                reader.readAsDataURL(file);
            });
        }

        const savePhotoBtn = document.querySelector('#editPhotoModal .edit-btn-primary');
        if (savePhotoBtn) {
            savePhotoBtn.addEventListener('click', () => {
                const src = photoInput && photoInput._pendingSrc;
                if (!src) {
                    alert('Please choose a photo first.');
                    return;
                }

                if (avatarImage) {
                    avatarImage.src = src;
                    avatarImage.style.display = '';
                }
                if (avatarPlaceholder) {
                    avatarPlaceholder.style.display = 'none';
                }

                closeModal(modals.editPhoto);

                if (modalImage) { modalImage.src = ''; modalImage.style.display = 'none'; }
                if (modalPlaceholder) modalPlaceholder.style.display = '';
                if (filenameLabel) { filenameLabel.style.display = 'none'; filenameLabel.textContent = ''; }
                if (photoInput) { photoInput.value = ''; delete photoInput._pendingSrc; }
            });
        }

        if (avatarPlaceholder) {
            avatarPlaceholder.addEventListener('click', () => openModal(modals.editPhoto));
        }

        // ── SAVE BANK DETAILS (demo) ─────────────────────────────
        function saveBank() {
            const holder = document.querySelector('[name="accountHolder"]').value;
            const bank = document.querySelector('[name="bankName"]').value;
            const account = document.querySelector('[name="accountNumber"]').value;
            const type = document.querySelector('[name="accountType"]').value;

            if (!holder || !bank || !account || !type) {
                alert('Please fill in all required bank details.');
                return;
            }

            if (account.length !== 10) {
                alert('Account number must be 10 digits.');
                return;
            }

            const maskedAccount = '**** **** ' + account.slice(-4);
            const bankContent = document.getElementById('bankContent');
            bankContent.innerHTML = `
                <div class="info-item">
                    <p class="info-label">Account Holder</p>
                    <p class="info-value">${holder}</p>
                </div>
                <div class="info-item">
                    <p class="info-label">Bank Name</p>
                    <p class="info-value">${bank}</p>
                </div>
                <div class="info-item">
                    <p class="info-label">Account Number</p>
                    <p class="info-value" style="font-family:'DM Mono',monospace">${maskedAccount}</p>
                    <p class="text-xs mt-0.5" style="color:var(--text-muted)">(last 4 digits shown for security)</p>
                </div>
                <div class="info-item">
                    <p class="info-label">Account Type</p>
                    <p class="info-value">${type}</p>
                </div>
            `;

            const bankStatus = document.getElementById('bankStatus');
            bankStatus.innerHTML = `
                <span class="completion-chip chip-complete">
                    <span class="material-icons-round" style="font-size:0.75rem">check_circle</span> Set up
                </span>
                <button onclick="document.getElementById('editBankModal').classList.add('active');document.body.style.overflow='hidden'"
                        class="edit-btn edit-btn-ghost">
                    <span class="material-icons-round" style="font-size:0.85rem">edit</span> Edit
                </button>
            `;

            closeModal(modals.editBank);
            updateCompletion();
        }

        // ── THEME TOGGLE ─────────────────────────────────────────
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
            const themeIcon = themeToggle.querySelector('.material-icons-round');
            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                if (themeIcon) themeIcon.textContent = isDark ? 'light_mode' : 'dark_mode';
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });
        }

        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            const icon = document.querySelector('#themeToggle .material-icons-round');
            if (icon) icon.textContent = 'light_mode';
        }
    </script>
</main>
</body>
</html>